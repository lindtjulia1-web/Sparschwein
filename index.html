<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        :root {
            --gold: #f9e076;
            --gold-deep: #bf953f;
            --error-red: #ff5252;
            --glass-line: rgba(255, 255, 255, 0.25);
        }
        body { background: #0a0a0a; margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        .game-card {
            width: 380px; background: #111; border-radius: 45px; padding: 35px;
            text-align: center; border: 1px solid #222; box-shadow: 0 40px 120px rgba(0,0,0,0.9);
            position: relative;
        }

        .lang-switch { position: absolute; top: 25px; right: 35px; display: flex; gap: 8px; z-index: 20; }
        .lang-btn {
            background: #1a1a1a; border: 1px solid #333; color: #555;
            font-size: 10px; padding: 4px 10px; cursor: pointer; border-radius: 6px; transition: 0.3s;
        }
        .lang-btn.active { border-color: var(--gold); color: var(--gold); background: #221e0a; }

        .pig-container { position: relative; width: 300px; height: 220px; margin: 0 auto; }

        .pig-svg { width: 100%; height: 100%; filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.05)); transition: 0.5s; overflow: visible; }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –æ–±—ä–µ–º–Ω–æ–≥–æ –ø–µ—Å–∫–∞ */
        #sand-rect { 
            transition: y 1.5s ease-in-out, height 1.5s ease-in-out;
            filter: url(#sand-volume) url(#shimmer);
        }

        .falling-grain { position: absolute; width: 4px; height: 4px; background: #ffe680; border-radius: 50%; z-index: 10; pointer-events: none; }
        .leak-grain { position: absolute; width: 3px; height: 3px; background: #555; border-radius: 50%; z-index: 10; pointer-events: none; }
        .confetti { position: absolute; width: 8px; height: 8px; z-index: 100; pointer-events: none; border-radius: 2px; }

        .score { font-size: 58px; color: var(--gold); font-weight: bold; margin: 10px 0; text-shadow: 0 0 20px rgba(249, 224, 118, 0.2); }
        .q-text { min-height: 80px; font-size: 18px; color: #ddd; margin: 15px 0; line-height: 1.4; display: flex; align-items: center; justify-content: center; }
        
        .btn-group { display: flex; flex-direction: column; gap: 10px; align-items: center; }
        .row { display: flex; gap: 10px; justify-content: center; width: 100%; flex-wrap: wrap; }
        
        .btn {
            background: transparent; border: 1px solid var(--gold); color: var(--gold);
            padding: 12px 24px; border-radius: 14px; cursor: pointer; font-weight: bold; transition: 0.2s;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .btn:hover { background: var(--gold); color: #000; box-shadow: 0 0 20px rgba(249, 224, 118, 0.4); }
        .btn-ans { border-color: #333; color: #fff; width: 45%; font-size: 12px; padding: 10px; }

        .feedback { font-size: 14px; font-weight: bold; margin-bottom: 10px; min-height: 20px; }
        .hidden { display: none; }
        
        .shake { animation: shake 0.4s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        /* –ö–ª–∞—Å—Å—ã –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∞ —Å—Ç–µ–∫–ª–∞ */
        .glass-body { fill: rgba(255, 255, 255, 0.03); }
        .glass-highlight { opacity: 0.3; }
    </style>
</head>
<body>

<div class="game-card">
    <div class="lang-switch">
        <button class="lang-btn active" onclick="setLang('ru', this)">RU</button>
        <button class="lang-btn" onclick="setLang('en', this)">EN</button>
        <button class="lang-btn" onclick="setLang('de', this)">DE</button>
    </div>

    <div class="pig-container" id="pig-box">
        <svg class="pig-svg" id="main-pig" viewBox="0 0 320 220" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <mask id="pig-mask">
                    <path d="M60,110 C60,75 110,55 170,55 C240,55 285,85 285,125 C285,160 235,185 170,185 C105,185 60,155 60,110" fill="white" />
                </mask>
                <linearGradient id="gold-grad" x1="0" y1="1" x2="0" y2="0">
                    <stop offset="0%" stop-color="#bf953f" />
                    <stop offset="30%" stop-color="#f9e076" />
                    <stop offset="60%" stop-color="#fcf6ba" />
                    <stop offset="100%" stop-color="#b38728" />
                </linearGradient>
                
                <filter id="shimmer">
                    <feTurbulence type="fractalNoise" baseFrequency="0.9" numOctaves="3" result="noise" />
                    <feColorMatrix type="matrix" values="1 0 0 0 0.9  0 1 0 0 0.7  0 0 1 0 0.2  0 0 0 1 0" />
                    <feComposite operator="in" in2="SourceGraphic" />
                </filter>

                <filter id="sand-volume">
                    <feSpecularLighting surfaceScale="5" specularConstant="0.8" specularExponent="15" lighting-color="#ffffff" in="SourceGraphic" result="spec">
                        <fePointLight x="160" y="80" z="200" />
                    </feSpecularLighting>
                    <feComposite in="SourceGraphic" in2="spec" operator="arithmetic" k1="0" k2="1" k3="1" k4="0" />
                </filter>
            </defs>

            <path d="M62,112 C62,77 112,57 172,57 C242,57 287,87 287,127 C287,162 237,187 172,187 C107,187 62,157 62,112" 
                  fill="rgba(255,255,255,0.02)" stroke="rgba(255,255,255,0.05)" stroke-width="1" />

            <g mask="url(#pig-mask)">
                <rect id="sand-rect" x="50" y="185" width="250" height="0" fill="url(#gold-grad)" />
            </g>

            <path id="pig-outline" class="glass-body" d="M60,110 C60,75 110,55 170,55 C240,55 285,85 285,125 C285,160 235,185 170,185 C105,185 60,155 60,110" 
                  stroke="var(--glass-line)" stroke-width="1.5" />

            <path class="glass-highlight" d="M85,90 C95,75 130,65 160,65" fill="none" stroke="white" stroke-width="3" stroke-linecap="round" />
            <path class="glass-highlight" d="M220,75 C240,85 255,100 265,120" fill="none" stroke="white" stroke-width="1.5" stroke-linecap="round" />

            <path d="M60,105 L45,105 C42,105 40,108 40,113 C40,118 42,121 45,121 L60,121" fill="none" stroke="var(--glass-line)" stroke-width="1.5" />
            <ellipse cx="40" cy="113" rx="3" ry="8" fill="none" stroke="var(--glass-line)" stroke-width="1.2" />

            <path d="M100,62 L95,40 L120,55" fill="none" stroke="var(--glass-line)" stroke-width="1.5" stroke-linejoin="round" />
            <path d="M160,56 L175,35 L185,55" fill="none" stroke="var(--glass-line)" stroke-width="1.5" stroke-linejoin="round" />

            <path d="M285,125 C305,120 310,140 300,145 C292,148 288,135 298,132 C302,131 305,135 303,139" fill="none" stroke="var(--glass-line)" stroke-width="1" />

            <path d="M110,185 C110,205 90,205 90,185" fill="none" stroke="var(--glass-line)" stroke-width="1.8" stroke-linecap="round" />
            <path d="M140,190 C140,210 120,210 120,190" fill="none" stroke="var(--glass-line)" stroke-width="1.8" stroke-linecap="round" />
            <path d="M210,190 C210,210 190,210 190,190" fill="none" stroke="var(--glass-line)" stroke-width="1.8" stroke-linecap="round" />
            <path d="M240,185 C240,205 220,205 220,185" fill="none" stroke="var(--glass-line)" stroke-width="1.8" stroke-linecap="round" />

            <ellipse cx="170" cy="55" rx="18" ry="3" fill="rgba(0,0,0,0.5)" stroke="var(--glass-line)" stroke-width="1" />
        </svg>
    </div>

    <div id="diff-tag" style="font-size: 10px; color: #444; margin-top: 10px; letter-spacing: 2px;">LEVEL: SELECT</div>
    <div class="score" id="total-val">0</div>
    <div id="question-box">
        <div class="q-text" id="question">–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–æ–∂–Ω–æ—Å—Ç—å:</div>
        <div id="diff-screen" class="btn-group">
            <div class="row">
                <button class="btn" onclick="initGame('easy')">EASY</button>
                <button class="btn" onclick="initGame('hard')">HARD</button>
            </div>
        </div>
        <div id="bet-screen" class="hidden">
            <div class="row">
                <button class="btn" onclick="askQuestion(10)">10</button>
                <button class="btn" onclick="askQuestion(25)">25</button>
                <button class="btn" onclick="askQuestion(50)">50</button>
            </div>
        </div>
        <div id="ans-screen" class="hidden">
            <div class="row" id="ans-list"></div>
        </div>
        <div id="res-screen" class="hidden">
            <div id="res-msg" class="feedback"></div>
            <button class="btn" id="next-btn" onclick="nextAction()"></button>
            <button class="btn hidden" id="restart-btn" onclick="location.reload()">RESTART</button>
        </div>
    </div>
</div>

<script>
    let score = 0, difficulty = 'easy', currentBet = 0, curLang = 'ru', qIdx = 0, isGameOver = false;
    const MAX_SCORE = 500, PIG_BOTTOM = 185;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playTone(freq, type, duration, vol) {
        const osc = audioCtx.createOscillator(), gain = audioCtx.createGain();
        osc.type = type; osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain); gain.connect(audioCtx.destination);
        osc.start(); osc.stop(audioCtx.currentTime + duration);
    }

    const data = {
        ru: { 
            next: "–î–ê–õ–ï–ï", win: "–í–ï–†–ù–û!", loss: "–£–¢–ï–ß–ö–ê –ü–ï–°–ö–ê...", finish: "–ó–û–õ–û–¢–û–ï –ò–ó–û–ë–ò–õ–ò–ï!",
            easy: [
                {q:"Ich ... (haben) ein Haus.", a:["habe","hast","hat","haben"], c:0},
                {q:"Du ... (sein) sch√∂n.", a:["bist","ist","sind","bin"], c:0},
                {q:"Wir ... (gehen) nach Hause.", a:["gehen","gehst","geht","gegangen"], c:0},
                {q:"Er ... (essen) Apfel.", a:["isst","essen","esst","esse"], c:0},
                {q:"Sie ... (trinken) Wasser.", a:["trinkt","trinken","trinkst","getrunken"], c:0}
            ],
            hard: [
                {q:"–ï—Å–ª–∏ –±—ã —è –±—ã–ª –±–æ–≥–∞—Ç (Konjunktiv II)...", a:["W√§re ich reich","Ich bin reich","Ich war reich","W√ºrde —è reich"], c:0},
                {q:"–Ø –±—ã –ø–æ—à–µ–ª (w√ºrde-form)...", a:["Ich w√ºrde gehen","Ich werde gehen","Ich bin gegangen","Ich gehe"], c:0},
                {q:"–ù–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –¥–æ–∂–¥—å...", a:["Trotz des Regens","Wegen dem Regen","Bei dem Regen","Trotz dem Regen"], c:0},
                {q:"–Ø –∂–¥—É —Ç–µ–±—è (Pr√§position)...", a:["Ich warte auf dich","Ich warte f√ºr dich","Ich warte dich","Ich warte an dich"], c:0},
                {q:"–û–Ω–∞ —Å–∫–∞–∑–∞–ª–∞, —á—Ç–æ –ø—Ä–∏–¥–µ—Ç...", a:["..., dass sie kommt","..., weil sie kommt","..., ob –æ–Ω–∞ kommt","..., –∫–æ–≥–¥–∞ sie kommt"], c:0}
            ]
        },
        en: { 
            next: "NEXT", win: "CORRECT!", loss: "SAND LEAK...", finish: "GOLDEN VICTORY!",
            easy: [
                {q:"I ... (be) a student.", a:["am","is","are","be"], c:0},
                {q:"They ... (play) football.", a:["play","plays","playing","played"], c:0},
                {q:"She ... (like) pizza.", a:["likes","like","liking","liked"], c:0},
                {q:"We ... (go) to school.", a:["go","goes","going","gone"], c:0},
                {q:"He ... (have) a dog.", a:["has","have","having","had"], c:0}
            ],
            hard: [
                {q:"If I ... you, I would go.", a:["were","was","am","be"], c:0},
                {q:"She ... here for 5 years.", a:["has been","is","was","has being"], c:0},
                {q:"By tomorrow, I ... it.", a:["will have done","will do","did","have done"], c:0},
                {q:"I look forward to ... you.", a:["seeing","see","to see","seen"], c:0},
                {q:"Hardly ... when it rain.", a:["had I left","I left","I have left","did I leave"], c:0}
            ]
        },
        de: { 
            next: "WEITER", win: "RICHTIG!", loss: "SANDVERLUST...", finish: "GOLDENER SIEG!",
            easy: [
                {q:"Ich ... (lernen) Deutsch.", a:["lerne","lernst","lernt","lernen"], c:0},
                {q:"Das ... (sein) gut.", a:["ist","sind","bin","seid"], c:0},
                {q:"Mein Vater ... (arbeiten).", a:["arbeitet","arbeiten","arbeitest","gearbeitet"], c:0},
                {q:"Das Wetter ... (sein) kalt.", a:["ist","sind","war","w√§re"], c:0},
                {q:"Wo ... (wohnen) du?", a:["wohnst","wohnen","wohnt","wohnte"], c:0}
            ],
            hard: [
                {q:"Nachdem er ... (essen), ging er.", a:["gegessen hatte","a√ü","essen","hat gegessen"], c:0},
                {q:"Das Haus, ... ich woh–Ω–µ.", a:["in dem","das","welches","worin"], c:0},
                {q:"Statt ... (helfen), schlief er.", a:["zu helfen","hilft","helfen","geholfen"], c:0},
                {q:"Je mehr, ... besser.", a:["desto","als","wie","umso"], c:0},
                {q:"Er tut so, als ... er reich.", a:["w√§re","ist","sei","war"], c:0}
            ]
        }
    };

    function initGame(d) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        difficulty = d; qIdx = 0;
        document.getElementById('diff-tag').innerText = `LEVEL: ${d.toUpperCase()}`;
        document.getElementById('diff-screen').classList.add('hidden');
        showBetScreen();
    }

    function showBetScreen() {
        if(isGameOver) return;
        document.getElementById('res-screen').classList.add('hidden');
        document.getElementById('bet-screen').classList.remove('hidden');
        document.getElementById('question').innerText = (curLang === 'ru' ? "–í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç–∞–≤–∫—É:" : "Choose bet:");
    }

    function askQuestion(bet) {
        currentBet = bet; document.getElementById('bet-screen').classList.add('hidden');
        const q = data[curLang][difficulty][qIdx];
        document.getElementById('question').innerText = q.q;
        const list = document.getElementById('ans-list'); list.innerHTML = '';
        q.a.forEach((txt, i) => { list.innerHTML += `<button class="btn btn-ans" onclick="checkAnswer(${i})">${txt}</button>`; });
        document.getElementById('ans-screen').classList.remove('hidden');
    }

    function checkAnswer(idx) {
        const isCorrect = idx === data[curLang][difficulty][qIdx].c;
        document.getElementById('ans-screen').classList.add('hidden');
        if(isCorrect) {
            score += currentBet;
            playTone(880, 'sine', 0.1, 0.2); setTimeout(() => playTone(1320, 'sine', 0.2, 0.1), 100);
            dropSandEffect();
            document.getElementById('res-msg').style.color = "var(--gold)";
        } else {
            score = Math.max(0, score - currentBet);
            playTone(150, 'sawtooth', 0.3, 0.1);
            leakSandEffect();
            document.getElementById('res-msg').style.color = "var(--error-red)";
        }
        document.getElementById('total-val').innerText = score;
        document.getElementById('res-msg').innerText = isCorrect ? data[curLang].win : data[curLang].loss;
        document.getElementById('next-btn').innerText = data[curLang].next;
        document.getElementById('res-screen').classList.remove('hidden');
        updateSandLevel();
    }

    function nextAction() {
        qIdx++;
        if (qIdx >= data[curLang][difficulty].length) {
            if (difficulty === 'easy') {
                difficulty = 'hard'; qIdx = 0;
                document.getElementById('diff-tag').innerText = `LEVEL: BONUS HARD`;
            } else { qIdx = 0; }
        }
        showBetScreen();
    }

    function dropSandEffect() {
        const container = document.getElementById('pig-box');
        for(let i=0; i<15; i++) {
            setTimeout(() => {
                const grain = document.createElement('div');
                grain.className = 'falling-grain';
                grain.style.left = (160 + Math.random() * 20) + 'px';
                grain.style.top = '55px';
                container.appendChild(grain);
                grain.animate([{ transform: 'translateY(0)', opacity: 1 }, { transform: `translate(${Math.random()*40-20}px, 110px)`, opacity: 0 }], { duration: 1000 }).onfinish = () => grain.remove();
            }, i * 40);
        }
    }

    function leakSandEffect() {
        document.getElementById('pig-box').classList.add('shake');
        setTimeout(() => document.getElementById('pig-box').classList.remove('shake'), 400);
        const container = document.getElementById('pig-box');
        for(let i=0; i<10; i++) {
            const grain = document.createElement('div');
            grain.className = 'leak-grain';
            grain.style.left = (120 + Math.random() * 80) + 'px';
            grain.style.top = '185px';
            container.appendChild(grain);
            grain.animate([{ opacity: 1 }, { transform: 'translateY(50px)', opacity: 0 }], 600).onfinish = () => grain.remove();
        }
    }

    function updateSandLevel() {
        const sand = document.getElementById('sand-rect');
        const fillHeight = Math.min(130, (score / MAX_SCORE) * 130);
        sand.setAttribute('y', PIG_BOTTOM - fillHeight);
        sand.setAttribute('height', fillHeight);
        
        // –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–≤–µ—á–µ–Ω–∏–µ –∫–æ–Ω—Ç—É—Ä–∞ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–æ–ª–æ—Ç–∞
        document.getElementById('pig-outline').style.stroke = `rgba(249, 224, 118, ${0.2 + (score/MAX_SCORE * 0.5)})`;
        document.getElementById('main-pig').style.filter = `drop-shadow(0 0 ${score/25}px rgba(249, 224, 118, 0.4))`;
        
        if (score >= MAX_SCORE) finishGame();
    }

    function finishGame() {
        isGameOver = true;
        playTone(523.25, 'sine', 0.2, 0.2); setTimeout(() => playTone(659.25, 'sine', 0.2, 0.2), 150); setTimeout(() => playTone(783.99, 'sine', 0.4, 0.3), 300);
        for(let i=0; i<60; i++) {
            const c = document.createElement('div'); c.className = 'confetti';
            c.style.left = Math.random() * 100 + '%'; c.style.top = '-10px';
            c.style.backgroundColor = ['#f9e076', '#bf953f', '#fff', '#aa771c'][Math.floor(Math.random()*4)];
            document.body.appendChild(c);
            c.animate([{ transform: 'translateY(0) rotate(0deg)', opacity: 1 }, { transform: `translate(${Math.random()*300-150}px, 110vh) rotate(${Math.random()*720}deg)`, opacity: 0 }], { duration: 3000 + Math.random()*2000 }).onfinish = () => c.remove();
        }
        document.getElementById('next-btn').classList.add('hidden');
        document.getElementById('restart-btn').classList.remove('hidden');
        document.getElementById('res-msg').innerText = data[curLang].finish;
        document.getElementById('question').innerText = "üèÜ";
    }

    function setLang(l, btn) {
        curLang = l;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        if(!isGameOver) document.getElementById('next-btn').innerText = data[curLang].next;
    }
</script>
</body>
</html>
