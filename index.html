<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>KGB Pile Editor Pro + Pirate Stakes</title>
    <style>
        :root { --accent: #f9e076; --bg: #1e1e24; --panel: #2a2a32; --border: #3d3d45; --green: #4caf50; --red: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 380px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 25px; }
        h2 { color: var(--accent); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin: 25px 0 10px; border-left: 3px solid var(--accent); padding-left: 10px; }
        .card { background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 15px; border-radius: 20px; margin-bottom: 15px; position: relative; }
        .del-btn { position: absolute; top: 12px; right: 15px; color: var(--red); cursor: pointer; font-weight: bold; font-size: 11px; }
        .sidebar-content label { display: block; font-size: 10px; color: #aaa; text-transform: uppercase; margin-top: 8px; }
        .sidebar-content input, .sidebar-content select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 12px; margin-top: 5px; box-sizing: border-box; outline: none; }
        .btn { background: #3d3d45; color: #fff; border: none; padding: 14px; width: 100%; border-radius: 15px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: #ffb347; color: #000; margin-top: 20px; } 
        .preview { flex: 1; background: #0c0c0e; display: flex; align-items: center; justify-content: center; }
        #device-wrapper { border: 1px solid #333; background: #000; position: relative; overflow: hidden; border-radius: 30px; transition: 0.3s; }
        iframe { width: 100%; height: 100%; border: none; background: transparent; }
        #code-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 100; flex-direction: column; }
        textarea { width: 80%; height: 50%; background: #111; color: var(--accent); padding: 20px; border: 1px solid var(--accent); border-radius: 20px; }
        @keyframes billboard { 0%, 100% { filter: brightness(1) drop-shadow(0 0 2px var(--shad)); } 50% { filter: brightness(1.3) drop-shadow(0 0 15px var(--shad)); } }
        .anim-border { animation: billboard 2s infinite ease-in-out; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>Запуск и Тексты</h2>
        <input type="text" id="start-title" value="Готовы к игре?">
        <label>Текст кнопки</label>
        <input type="text" id="start-btn-text" value="НАЧАТЬ">
        
        <h2>Настройки копилки</h2>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div><label>Контур</label><input type="color" id="pigColor" value="#ffffff"></div>
            <div><label>Толщина</label><input type="number" id="pigStroke" value="2"></div>
        </div>

        <h2>Оформление</h2>
        <label>Рамка виджета</label>
        <input type="color" id="borderColor" value="#f9e076">
        <label>Шрифт</label>
        <select id="fontFamily">
            <option value="'ABeeZee', sans-serif">ABeeZee</option>
            <option value="'Montserrat', sans-serif">Montserrat</option>
        </select>

        <h2>Вопросы</h2>
        <div id="q-container"></div>
        <button class="btn" onclick="addQ()">+ ВОПРОС</button>
        
        <label>Язык</label>
        <select id="lang">
            <option value="ru">Русский</option>
            <option value="en">English</option>
            <option value="de">Deutsch</option>
        </select>
    </div>
    <div style="padding: 20px; border-top: 1px solid var(--border);">
        <button class="btn btn-main" onclick="updatePreview()">ОБНОВИТЬ ПРЕВЬЮ</button>
        <button class="btn" onclick="getGeniallyCode()">ПОЛУЧИТЬ КОД</button>
    </div>
</div>

<div class="preview">
    <div id="device-wrapper" class="anim-border"><iframe id="ifr"></iframe></div>
</div>

<div id="code-modal">
    <textarea id="result-code" readonly></textarea>
    <button class="btn" onclick="document.getElementById('code-modal').style.display='none'" style="width: 200px">ЗАКРЫТЬ</button>
</div>

<script>
function addQ(qText, correct, wrongs) {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `<span class="del-btn" onclick="this.parentElement.remove()">УДАЛИТЬ</span>
        <label>Вопрос</label><input type="text" class="inp-q" value="${qText || ''}">
        <input type="text" class="inp-correct" placeholder="Верный" value="${correct || ''}">
        <input type="text" class="inp-wrong" placeholder="Ложные через запятую" value="${wrongs || ''}">`;
    document.getElementById('q-container').appendChild(div);
}

function buildInnerGame() {
    const cfg = {
        title: document.getElementById('start-title').value,
        btn: document.getElementById('start-btn-text').value,
        pigColor: document.getElementById('pigColor').value,
        pigStroke: document.getElementById('pigStroke').value,
        borderColor: document.getElementById('borderColor').value,
        lang: document.getElementById('lang').value,
        font: document.getElementById('fontFamily').value,
        data: Array.from(document.querySelectorAll('.card')).map(c => ({
            q: c.querySelector('.inp-q').value,
            a: [c.querySelector('.inp-correct').value, ...c.querySelector('.inp-wrong').value.split(',')]
        })).filter(x => x.q)
    };

    return `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>
        body { margin:0; height:100vh; background:#000; font-family:${cfg.font}; color:#fff; display:flex; flex-direction:column; overflow:hidden; border:4px solid ${cfg.borderColor}; box-sizing:border-box; }
        #pile-container { flex:1; position:relative; display:flex; align-items:center; justify-content:center; overflow:hidden; }
        .piggy-bank { width:280px; z-index:5; position:relative; }
        .coins-inside { position:absolute; bottom:32%; width:130px; height:80px; display:flex; flex-wrap:wrap-reverse; justify-content:center; align-items:flex-start; z-index:4; }
        .stored-coin { width:22px; height:22px; background:radial-gradient(circle at 30% 30%, #ffd700, #b8860b); border:1px solid #5a4408; border-radius:50%; margin:-3px; box-shadow:0 2px 4px rgba(0,0,0,0.5); position:relative; }
        .stored-coin::after { content:"☠"; position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-size:12px; color:rgba(0,0,0,0.5); }
        .falling-coin { position:absolute; width:40px; height:40px; z-index:10; animation: fall 1s cubic-bezier(0.6, 0, 0.4, 1) forwards; }
        @keyframes fall { 0% { top:-50px; opacity:0; transform:rotate(0deg); } 20% { opacity:1; } 100% { top:45%; opacity:1; transform:rotate(720deg); } }
        .ui { padding:20px; display:grid; gap:10px; }
        .btn-ans { background:rgba(255,215,0,0.1); border:1px solid gold; color:gold; padding:15px; border-radius:15px; cursor:pointer; font-weight:bold; }
        .screen { position:absolute; inset:0; background:rgba(0,0,0,0.9); display:flex; align-items:center; justify-content:center; z-index:100; flex-direction:column; }
    </style></head><body>
        <div id="start" class="screen"><h1>${cfg.title}</h1><button class="btn-ans" onclick="this.parentElement.remove()"> ${cfg.btn} </button></div>
        <div id="pile-container">
            <div class="coins-inside" id="coins"></div>
            <svg class="piggy-bank" viewBox="0 0 240 200" xmlns="http://www.w3.org/2000/svg">
                <path d="M40,110 C40,60 80,45 120,45 C170,45 210,65 210,110 C210,150 170,165 120,165 C80,165 40,150 40,110 Z" fill="none" stroke="${cfg.pigColor}" stroke-width="${cfg.pigStroke}"/>
                <path d="M210,100 C225,100 230,105 230,115 C230,125 225,130 210,130" fill="none" stroke="${cfg.pigColor}" stroke-width="${cfg.pigStroke}"/>
                <circle cx="185" cy="85" r="3" fill="${cfg.pigColor}"/>
                <path d="M150,55 L165,30 M110,50 L120,25" stroke="${cfg.pigColor}" stroke-width="${cfg.pigStroke}"/>
                <rect x="110" y="45" width="25" height="5" fill="none" stroke="${cfg.pigColor}" stroke-width="${cfg.pigStroke}"/>
                <path d="M40,110 C20,110 15,90 30,85" fill="none" stroke="${cfg.pigColor}" stroke-width="${cfg.pigStroke}"/>
            </svg>
        </div>
        <div class="ui" id="ctrl"></div>
    <script>
        let qi=0; const data=${JSON.stringify(cfg.data)};
        function next() {
            if(qi>=data.length) return;
            document.getElementById('ctrl').innerHTML = '';
            data[qi].a.forEach(t => {
                const b = document.createElement('button'); b.className='btn-ans'; b.innerText=t;
                b.onclick = () => { if(t===data[qi].a[0]) drop(); qi++; next(); };
                document.getElementById('ctrl').appendChild(b);
            });
        }
        function drop() {
            const c = document.createElement('div'); c.className='falling-coin'; 
            c.innerHTML = '<div class="stored-coin" style="width:40px;height:40px"></div>';
            c.style.left = '50%'; c.style.transform = 'translateX(-50%)';
            document.getElementById('pile-container').appendChild(c);
            setTimeout(() => { c.remove(); 
                const s = document.createElement('div'); s.className='stored-coin';
                document.getElementById('coins').appendChild(s);
            }, 1000);
        }
        next();
    <\/script></body></html>`;
}

function updatePreview() {
    const dev = document.getElementById('device-wrapper');
    dev.style.setProperty('--shad', document.getElementById('borderColor').value);
    dev.style.width = '400px'; dev.style.height = '600px';
    document.getElementById('ifr').srcdoc = buildInnerGame();
}

window.onload = () => { addQ('Сколько золотых?', '100', '50,20'); updatePreview(); };
</script>
</body>
</html>
