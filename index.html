<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Sparschwein Admin Panel</title>
    <style>
        :root { --accent: #f9e076; --bg: #0d0d0f; --card: #16161a; --border: #2d2d33; }
        body { font-family: 'Inter', sans-serif; background: var(--bg); color: #e1e1e6; margin: 0; display: flex; height: 100vh; }
        
        /* Sidebar Navigation */
        .nav { width: 70px; background: #08080a; border-right: 1px solid var(--border); display: flex; flex-direction: column; align-items: center; padding-top: 20px; gap: 20px; }
        .nav-icon { width: 40px; height: 40px; border-radius: 12px; background: #1a1a20; display: flex; align-items: center; justify-content: center; cursor: pointer; color: #555; transition: 0.3s; }
        .nav-icon.active { background: var(--accent); color: #000; }

        /* Panel Content */
        .sidebar { width: 400px; background: var(--card); border-right: 1px solid var(--border); display: flex; flex-direction: column; overflow: hidden; }
        .sidebar-header { padding: 25px; border-bottom: 1px solid var(--border); }
        .sidebar-scroll { flex: 1; overflow-y: auto; padding: 25px; scrollbar-width: thin; }
        
        h2 { font-size: 18px; margin: 0; color: #fff; letter-spacing: 0.5px; }
        .section-title { font-size: 11px; text-transform: uppercase; color: var(--accent); letter-spacing: 1.5px; margin: 25px 0 15px 0; font-weight: 800; display: flex; align-items: center; gap: 8px; }
        .section-title::after { content: ''; flex: 1; height: 1px; background: rgba(249, 224, 118, 0.2); }

        .input-box { margin-bottom: 20px; }
        label { display: block; font-size: 12px; color: #8a8a93; margin-bottom: 8px; }
        input, select, textarea { width: 100%; background: #1f1f27; border: 1px solid var(--border); color: #fff; padding: 12px; border-radius: 10px; font-size: 14px; outline: none; transition: 0.2s; box-sizing: border-box; }
        input:focus { border-color: var(--accent); box-shadow: 0 0 0 2px rgba(249,224,118,0.1); }
        
        .row { display: flex; gap: 10px; }
        .btn { background: var(--accent); color: #000; border: none; padding: 15px; border-radius: 12px; font-weight: 700; cursor: pointer; width: 100%; transition: 0.3s; font-size: 13px; text-transform: uppercase; }
        .btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .btn-code { background: #2d2d33; color: #fff; margin-top: 10px; }

        /* Preview Area */
        .preview { flex: 1; background: #050505; display: flex; align-items: center; justify-content: center; position: relative; }
        .device-mock { background: #111; border: 8px solid #222; border-radius: 40px; box-shadow: 0 50px 100px rgba(0,0,0,0.5); overflow: hidden; }
        iframe { width: 100%; height: 100%; border: none; }
        
        /* Modal */
        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); display: none; align-items: center; justify-content: center; z-index: 100; padding: 20px; }
        .modal-box { background: #1a1a1e; padding: 30px; border-radius: 20px; width: 100%; max-width: 700px; border: 1px solid var(--border); }
        code-area { display: block; background: #000; color: #f9e076; padding: 15px; border-radius: 10px; font-family: monospace; white-space: pre-wrap; font-size: 12px; height: 300px; overflow-y: auto; margin-bottom: 20px; border: 1px solid #333; }
    </style>
</head>
<body>

<div class="nav">
    <div class="nav-icon active">‚öôÔ∏è</div>
    <div class="nav-icon">üìÅ</div>
    <div class="nav-icon">üìä</div>
</div>

<div class="sidebar">
    <div class="sidebar-header">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ö–æ–ø–∏–ª–∫–∏</h2>
    </div>
    <div class="sidebar-scroll">
        <div class="section-title">–ö–æ–Ω—Ç–µ–Ω—Ç</div>
        <div class="input-box">
            <label>–¢–µ–∫—Å—Ç—ã –∑–∞–¥–∞–Ω–∏–π (JSON)</label>
            <textarea id="qs" style="height: 120px;">[{"q":"2+2*2?","a":["4","6","8"],"c":1}]</textarea>
        </div>
        <div class="input-box">
            <label>–¢–∏–ø –∑–∞–¥–∞–Ω–∏–π</label>
            <select id="qtype">
                <option value="choice">–í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞</option>
                <option value="oral">–£—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç</option>
                <option value="error">–ü–æ–∏—Å–∫ –æ—à–∏–±–∫–∏</option>
            </select>
        </div>

        <div class="section-title">–ú–µ—Ö–∞–Ω–∏–∫–∞</div>
        <div class="row">
            <div class="input-box">
                <label>–ú–∏–Ω. —Å—Ç–∞–≤–∫–∞</label>
                <input type="number" id="mmin" value="10">
            </div>
            <div class="input-box">
                <label>–ú–∞–∫—Å. —Å—Ç–∞–≤–∫–∞</label>
                <input type="number" id="mmax" value="100">
            </div>
        </div>
        <div class="input-box">
            <label>–®—Ç—Ä–∞—Ñ—ã (—É—Ç–µ—á–∫–∞ –ø–µ—Å–∫–∞)</label>
            <select id="penalty"><option value="on">–í–∫–ª</option><option value="off">–í—ã–∫–ª</option></select>
        </div>

        <div class="section-title">–ü—Ä–æ–≥—Ä–µ—Å—Å</div>
        <div class="input-box">
            <label>–†–∞–∑–º–µ—Ä –∫–æ–ø–∏–ª–∫–∏ (MAX)</label>
            <input type="number" id="pmax" value="500">
        </div>

        <div class="section-title">–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</div>
        <div class="input-box">
            <label>–Ø–∑—ã–∫</label>
            <select id="lang">
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="en">English</option>
                <option value="de">Deutsch</option>
            </select>
        </div>
    </div>
    
    <div style="padding: 25px; background: #111; border-top: 1px solid var(--border);">
        <button class="btn" onclick="update()">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é</button>
        <button class="btn btn-code" onclick="showCode()">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥</button>
    </div>
</div>

<div class="preview">
    <div class="device-mock" style="width: 380px; height: 580px;">
        <iframe id="ifr"></iframe>
    </div>
</div>

<div id="modal">
    <div class="modal-box">
        <h3 style="margin-top:0">–ö–æ–¥ –¥–ª—è Genially (Insert -> Others)</h3>
        <code-area id="code-res"></code-area>
        <button class="btn" onclick="document.getElementById('modal').style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
function buildWidget() {
    const conf = {
        qs: document.getElementById('qs').value,
        lang: document.getElementById('lang').value,
        pmax: document.getElementById('pmax').value,
        penalty: document.getElementById('penalty').value
    };

    return `<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        :root { --gold: #f9e076; --bg: #0a0a0a; }
        body { background: var(--bg); color: #fff; font-family: sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; overflow: hidden; }
        .card { width: 340px; text-align: center; }
        .pig-box { position: relative; width: 280px; height: 200px; margin: 0 auto; }
        #sand { transition: all 1s ease; }
        .score { font-size: 40px; color: var(--gold); font-weight: bold; margin: 10px 0; }
        .btn { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 10px; border-radius: 8px; cursor: pointer; margin: 5px; width: 80%; }
    </style>
</head>
<body>
    <div class="card">
        <div class="pig-box">
            <svg viewBox="0 0 200 150" style="width:100%; height:100%">
                <mask id="m"><path d="M30,80 C30,40 170,40 170,80 C170,120 30,120 30,80" fill="white"/></mask>
                <rect id="sand" x="0" y="120" width="200" height="0" fill="var(--gold)" mask="url(#m)"/>
                <path d="M30,80 C30,40 170,40 170,80 C170,120 30,120 30,80" fill="none" stroke="rgba(255,255,255,0.2)" stroke-width="2"/>
            </svg>
        </div>
        <div class="score" id="s">0</div>
        <div id="q"></div>
        <div id="ans"></div>
    </div>
    <script>
        let score = 0, idx = 0, qs = \${conf.qs};
        function show() {
            const item = qs[idx];
            document.getElementById('q').innerText = item.q;
            const ab = document.getElementById('ans'); ab.innerHTML = '';
            item.a.forEach((a, i) => {
                const b = document.createElement('button'); b.className='btn'; b.innerText=a;
                b.onclick = () => {
                    if(i === item.c) { score += 50; } 
                    else if('\${conf.penalty}'==='on') { score = Math.max(0, score-20); }
                    update(); idx = (idx+1)%qs.length; show();
                };
                ab.appendChild(b);
            });
        }
        function update() {
            document.getElementById('s').innerText = score;
            const h = (score / \${conf.pmax}) * 60;
            document.getElementById('sand').setAttribute('y', 120 - h);
            document.getElementById('sand').setAttribute('height', h);
        }
        show();
    <\/script>
</body></html>`;
}

function update() {
    const blob = new Blob([buildWidget()], {type: 'text/html'});
    document.getElementById('ifr').src = URL.createObjectURL(blob);
}

function showCode() {
    const code = buildWidget().replace(/"/g, '&quot;').replace(/'/g, '&apos;');
    document.getElementById('code-res').innerText = `<iframe width="380" height="580" srcdoc="\${code}" frameborder="0" scrolling="no" style="border:none;overflow:hidden;"></iframe>`;
    document.getElementById('modal').style.display = 'flex';
}
window.onload = update;
</script>
</body>
</html>
