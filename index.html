<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>KGB Pile Editor Pro + Stakes</title>
    <style>
        :root { --accent: #f9e076; --bg: #1e1e24; --panel: #2a2a32; --border: #3d3d45; --green: #4caf50; --red: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        .sidebar { width: 380px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 25px; }
        h2 { color: var(--accent); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin: 25px 0 10px; border-left: 3px solid var(--accent); padding-left: 10px; }
        .card { background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 15px; border-radius: 20px; margin-bottom: 15px; position: relative; }
        .del-btn { position: absolute; top: 12px; right: 15px; color: var(--red); cursor: pointer; font-weight: bold; font-size: 11px; }
        .sidebar-content label { display: block; font-size: 10px; color: #aaa; text-transform: uppercase; margin-top: 8px; }
        .sidebar-content input, .sidebar-content select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 12px; margin-top: 5px; box-sizing: border-box; outline: none; }
        .btn { background: #3d3d45; color: #fff; border: none; padding: 14px; width: 100%; border-radius: 15px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: #ffb347; color: #000; margin-top: 20px; } 
        .btn-code { background: #77dd77; color: #000; margin-top: 8px; } 
        .preview { flex: 1; background: #0c0c0e; display: flex; align-items: center; justify-content: center; }
        #device-wrapper { border: 1px solid #333; background: #000; position: relative; overflow: hidden; border-radius: 30px; transition: 0.3s; background-size: cover; background-position: center; }
        iframe { width: 100%; height: 100%; border: none; background: transparent; }
        #code-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 100; flex-direction: column; }
        textarea { width: 80%; height: 50%; background: #111; color: var(--accent); padding: 20px; border: 1px solid var(--accent); border-radius: 20px; font-family: monospace; }
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input[type="color"] { padding: 2px; height: 38px; cursor: pointer; border-radius: 10px; }
        @keyframes billboard { 0% { filter: brightness(1) drop-shadow(0 0 2px var(--shad)); } 50% { filter: brightness(1.5) drop-shadow(0 0 15px var(--shad)); } 100% { filter: brightness(1) drop-shadow(0 0 2px var(--shad)); } }
        .anim-border { animation: billboard 2s infinite ease-in-out; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>Запуск и Тексты</h2>
        <label>Заголовок при запуске</label>
        <input type="text" id="start-title" value="Сокровища пирата">
        <label>Текст кнопки запуска</label>
        <input type="text" id="start-btn-text" value="ИГРАТЬ">
        
        <h2>Настройки копилки</h2>
        <div class="color-grid">
            <div><label>Цвет стекла</label><input type="color" id="pigColor" value="#ffc0cb"></div>
            <div><label>Прозрачность</label><input type="range" id="pigAlpha" min="0.1" max="0.8" step="0.1" value="0.3"></div>
        </div>

        <h2>Оформление</h2>
        <label>Фон (URL)</label>
        <input type="text" id="bg-url" placeholder="URL картинки..." onchange="updatePreview()">
        
        <label>Размер шрифта (px)</label>
        <input type="range" id="fontSize" min="14" max="30" value="20" oninput="updatePreview()">

        <h2>Размер виджета</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <input type="number" id="width" value="400" onchange="updatePreview()">
            <input type="number" id="height" value="600" onchange="updatePreview()">
        </div>

        <h2>Вопросы</h2>
        <div id="q-container"></div>
        <button class="btn" onclick="addQ()">+ ДОБАВИТЬ ВОПРОС</button>

        <label>Язык</label>
        <select id="lang">
            <option value="ru">Русский</option>
            <option value="en">English</option>
            <option value="de">Deutsch</option>
        </select>

        <input type="hidden" id="btnColor" value="#f9e076">
    </div>
    <div style="padding: 20px; border-top: 1px solid var(--border);">
        <button class="btn btn-main" onclick="updatePreview()">ОБНОВИТЬ ПРЕВЬЮ</button>
        <button class="btn btn-code" onclick="getGeniallyCode()">ПОЛУЧИТЬ КОД</button>
    </div>
</div>

<div class="preview">
    <div id="device-wrapper" class="anim-border"><iframe id="ifr"></iframe></div>
</div>

<div id="code-modal">
    <textarea id="result-code" readonly onclick="this.select()"></textarea>
    <button class="btn" onclick="document.getElementById('code-modal').style.display='none'" style="width: 200px">ЗАКРЫТЬ</button>
</div>

<script>
function addQ(qText, correct, wrongs) {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = '<span class="del-btn" onclick="this.parentElement.remove()">УДАЛИТЬ</span>' +
        '<label>Вопрос</label><input type="text" class="inp-q" value="'+(qText||"")+'">' +
        '<label style="color:var(--green)">✓ Верный</label>' +
        '<input type="text" class="inp-correct" value="'+(correct||"")+'">' +
        '<label style="color:var(--red)">× Ложные</label>' +
        '<input type="text" class="inp-wrong" value="'+(wrongs||"")+'">';
    document.getElementById('q-container').appendChild(div);
}

function buildInnerGame() {
    const cfg = {
        bg: document.getElementById('bg-url').value,
        startTitle: document.getElementById('start-title').value,
        startBtn: document.getElementById('start-btn-text').value,
        pigColor: document.getElementById('pigColor').value,
        pigAlpha: document.getElementById('pigAlpha').value,
        fontSize: document.getElementById('fontSize').value,
        data: Array.from(document.querySelectorAll('.card')).map(c => ({
            q: c.querySelector('.inp-q').value,
            a: [c.querySelector('.inp-correct').value, ...c.querySelector('.inp-wrong').value.split(',').map(x => x.trim())]
        })).filter(x => x.q)
    };

    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <style>
        @keyframes coinFall { 0% { transform: translate(-50%, -150px) rotate(0deg); opacity: 0; } 20% { opacity: 1; } 100% { transform: translate(-50%, 120px) rotate(360deg); opacity: 0; } }
        @keyframes sparkle { 0%, 100% { filter: brightness(1); } 50% { filter: brightness(1.8) drop-shadow(0 0 3px gold); } }
        body { margin:0; height:100vh; overflow:hidden; font-family:sans-serif; background:#000; color:#fff; }
        .bg { position:fixed; inset:0; background:url(${cfg.bg}) center/cover no-repeat; opacity:0.4; z-index:-1; }
        #game-root { height:100%; display:flex; flex-direction:column; padding:20px; box-sizing:border-box; position:relative; }
        .score { font-size:48px; color:#f9e076; font-weight:900; text-align:center; }
        #pile-container { flex:1; position:relative; display:flex; justify-content:center; align-items:center; padding-bottom:150px; }
        .piggy-svg { width:240px; height:auto; z-index:5; filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5)); }
        .coins-inside { position:absolute; width:130px; height:80px; z-index:4; transform: translate(0, 15px); }
        .stored-coin { position:absolute; width:14px; height:14px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #fff9a3, #ffd700, #b8860b); border:1px solid #6b5411; animation: sparkle 3s infinite; }
        .falling-coin { position:absolute; left:50%; width:35px; height:35px; z-index:10; border-radius:50%; background:radial-gradient(circle at 35% 35%, #fffbea, #ffd700, #8b6914); border:2px solid #5a4408; pointer-events:none; }
        .interface { position:absolute; bottom:20px; left:20px; right:20px; height:180px; display:flex; flex-direction:column; justify-content:flex-end; }
        .label-sm { font-size:${cfg.fontSize}px; text-align:center; margin-bottom:15px; font-weight:bold; text-shadow: 0 2px 4px #000; }
        .grid { display:grid; gap:8px; height:110px; }
        .btn-ans, .btn-stake { border:2px solid #f9e076; background:rgba(0,0,0,0.6); color:#f9e076; padding:12px; border-radius:15px; cursor:pointer; font-weight:bold; font-size:16px; }
        .screen { position:absolute; inset:0; background:rgba(0,0,0,0.9); display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:100; }
    </style></head><body>
        <div class="bg"></div>
        <div id="game-root">
            <div id="start" class="screen"><h2>${cfg.startTitle}</h2><button class="btn-ans" onclick="startGame()">${cfg.startBtn}</button></div>
            <div class="score" id="s">0</div>
            <div id="pile-container">
                <svg class="piggy-svg" viewBox="0 0 250 200" xmlns="http://www.w3.org/2000/svg">
                    <path d="M210,100 C210,150 170,180 125,180 C80,180 40,150 40,100 C40,50 80,20 125,20 C170,20 210,50 210,100" fill="${cfg.pigColor}" opacity="${cfg.pigAlpha}" stroke="#fff" stroke-width="2"/>
                    <circle cx="50" cy="100" r="15" fill="${cfg.pigColor}" opacity="${cfg.pigAlpha}" stroke="#fff" stroke-width="2"/>
                    <circle cx="45" cy="95" r="3" fill="#333"/> <circle cx="45" cy="105" r="3" fill="#333"/>
                    <path d="M70,40 Q60,10 90,25" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
                    <path d="M180,40 Q190,10 160,25" fill="none" stroke="#fff" stroke-width="3" stroke-linecap="round"/>
                    <rect x="70" y="175" width="15" height="20" rx="5" fill="${cfg.pigColor}" opacity="${cfg.pigAlpha}" stroke="#fff" stroke-width="2"/>
                    <rect x="165" y="175" width="15" height="20" rx="5" fill="${cfg.pigColor}" opacity="${cfg.pigAlpha}" stroke="#fff" stroke-width="2"/>
                    <rect x="110" y="25" width="30" height="6" rx="3" fill="#000" opacity="0.6"/>
                </svg>
                <div class="coins-inside" id="coins"></div>
            </div>
            <div class="interface">
                <div class="label-sm" id="q-txt"></div>
                <div id="ctrl" class="grid"></div>
            </div>
        </div>
    <script>
        let qi=0, score=0, stake=0; const data=${JSON.stringify(cfg.data)};
        function startGame(){ document.getElementById('start').style.display='none'; showStakes(); }
        function showStakes(){
            document.getElementById('q-txt').innerText = "ВЫБЕРИТЕ СТАВКУ";
            const c = document.getElementById('ctrl'); c.innerHTML='<div style="display:grid;grid-template-columns:repeat(4,1fr);gap:5px"></div>';
            [10,25,50,100].forEach(v => {
                const b = document.createElement('button'); b.className='btn-stake'; b.innerText=v;
                b.onclick=()=>{ stake=v; showQ(); }; c.firstChild.appendChild(b);
            });
        }
        function showQ(){
            if(qi>=data.length){ document.getElementById('q-txt').innerText="ФИНАЛ!"; document.getElementById('ctrl').innerHTML=""; return; }
            document.getElementById('q-txt').innerText = data[qi].q;
            const c = document.getElementById('ctrl'); c.innerHTML='';
            [...data[qi].a].sort(()=>Math.random()-0.5).forEach(t => {
                const b = document.createElement('button'); b.className='btn-ans'; b.innerText=t;
                b.onclick=()=>{ 
                    if(t===data[qi].a[0]){ score+=stake; dropAnim(Math.ceil(stake/10)); }
                    else { score=Math.max(0,score-stake); remC(Math.ceil(stake/10)); }
                    document.getElementById('s').innerText=score; qi++; setTimeout(showStakes, 1600);
                }; c.appendChild(b);
            });
        }
        function dropAnim(n){
            for(let i=0; i<n; i++){
                setTimeout(()=>{
                    const f = document.createElement('div'); f.className='falling-coin';
                    document.getElementById('pile-container').appendChild(f);
                    f.style.animation = 'coinFall 1.2s forwards';
                    setTimeout(()=>{ f.remove(); addStored(); }, 1100);
                }, i*120);
            }
        }
        function addStored(){
            const c = document.getElementById('coins'), s = document.createElement('div');
            s.className='stored-coin';
            const r = Math.pow(Math.random(), 0.6) * 55;
            const a = Math.random() * Math.PI * 2;
            s.style.left = (65 + Math.cos(a)*r) + 'px';
            s.style.top = (65 + Math.sin(a)*(r*0.4) - (55-r)*0.5) + 'px';
            s.style.animationDelay = Math.random()*2+'s';
            c.appendChild(s);
        }
        function remC(n){ const c=document.getElementById('coins'); for(let i=0;i<n;i++) if(c.lastChild) c.lastChild.remove(); }
    <\/script></body></html>`;
}

function updatePreview() {
    const dev = document.getElementById('device-wrapper');
    dev.style.width = document.getElementById('width').value + 'px';
    dev.style.height = document.getElementById('height').value + 'px';
    dev.style.border = '4px solid #f9e076';
    const bgUrl = document.getElementById('bg-url').value;
    dev.style.backgroundImage = bgUrl ? 'url(' + bgUrl + ')' : 'none';
    const sCol = document.getElementById('shadowColor').value;
    dev.style.setProperty('--shad', sCol);
    document.getElementById('ifr').srcdoc = buildInnerGame();
}

function getGeniallyCode() {
    const html = buildInnerGame().replace(/"/g, '&quot;');
    document.getElementById('result-code').value = '<iframe width="100%" height="100%" srcdoc="' + html + '" frameborder="0" scrolling="no" style="border:none; overflow:hidden;"></iframe>';
    document.getElementById('code-modal').style.display = 'flex';
}

window.onload = () => { addQ('Главный пират?', 'Джек Воробей', 'Гарри Поттер, Колобок'); updatePreview(); };
</script>
</body>
</html>
