function buildInnerGame() {
    const cards = Array.from(document.querySelectorAll('#q-container .card'));
    const finalQs = cards.map(c => ({
        q: c.querySelector('.inp-q').value,
        a: [c.querySelector('.inp-correct').value].concat(c.querySelector('.inp-wrong').value.split(',').map(x => x.trim()))
    }));

    const cfg = {
        bg: document.getElementById('bg-url').value,
        startTitle: document.getElementById('start-title').value,
        startBtn: document.getElementById('start-btn-text').value,
        endText: document.getElementById('end-text').value || "КОНЕЦ ИГРЫ!",
        textColor: document.getElementById('textColor').value,
        borderColor: document.getElementById('borderColor').value,
        borderWidth: document.getElementById('borderWidth').value,
        shadowColor: document.getElementById('shadowColor').value,
        shadowBlur: document.getElementById('shadowBlur').value,
        lang: document.getElementById('lang').value,
        fontSize: document.getElementById('fontSize').value,
        btnColor: document.getElementById('btnColor').value,
        btnRgba: hexToRgba(document.getElementById('btnColor').value, document.getElementById('btnAlpha').value),
        data: finalQs
    };

    return `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>
    @keyframes coinFall { 0% { transform: translate(-50%, -200px); opacity: 0; } 20% { opacity: 1; } 100% { transform: translate(-50%, 60px); opacity: 0; } }
    body { margin:0; height:100vh; overflow:hidden; font-family: sans-serif; background:#000; color:${cfg.textColor}; display:flex; flex-direction:column; }
    .bg { position:fixed; inset:0; background:url(${cfg.bg}) center/cover; opacity:0.4; z-index:-1; }
    #game { flex:1; display:flex; flex-direction:column; padding:20px; border:${cfg.borderWidth}px solid ${cfg.borderColor}; box-shadow: 0 0 ${cfg.shadowBlur}px ${cfg.shadowColor}; box-sizing: border-box; position:relative; }
    .score { font-size:48px; text-align:center; color:${cfg.btnColor}; font-weight:bold; margin-top: 10px; text-shadow: 0 0 10px rgba(0,0,0,0.5); }
    #stage { flex:1; position:relative; display:flex; justify-content:center; align-items:center; min-height: 250px; }
    
    /* Свинка как на скрине 2 */
    .pig-container { width:280px; height:280px; position:relative; background: url('https://i.ibb.co/6R688S7/piggy-bank.png') center/contain no-repeat; }
    
    /* Контейнер для монет внутри */
    .coins-inside { position:absolute; bottom:60px; left:50%; transform:translateX(-50%); width:140px; height:80px; display:flex; flex-wrap:wrap-reverse; align-content:flex-start; justify-content:center; overflow:hidden; }
    .coin-mini { width:18px; height:18px; background:radial-gradient(circle at 30% 30%, #ffd95a, #8b6508); border-radius:50%; border:1px solid #5a4408; margin:1px; box-shadow: 0 2px 4px rgba(0,0,0,0.3); }
    
    /* Анимация падения монетки */
    .falling-coin { position:absolute; left:50%; top:20px; width:30px; height:30px; background:radial-gradient(circle, #fff4a3, #d4a645); border:2px solid #8b6508; border-radius:50%; z-index:10; animation: coinFall 0.6s ease-in forwards; }
    
    .grid { display:grid; gap:10px; width: 100%; max-width: 400px; margin: 0 auto; }
    .btn { background:${cfg.btnRgba}; border:1px solid ${cfg.btnColor}; color:${cfg.btnColor}; padding:12px; border-radius:15px; cursor:pointer; font-weight:bold; font-size:${cfg.fontSize}px; transition: 0.2s; }
    .btn:active { transform: scale(0.95); }
    .screen { position:absolute; inset:0; background:rgba(0,0,0,0.9); z-index:100; display:none; flex-direction:column; align-items:center; justify-content:center; text-align:center; padding: 20px; }
    .active { display:flex; }
    #q-txt { text-align:center; margin:15px 0; font-weight: bold; text-transform: uppercase; letter-spacing: 1px; }
    </style></head><body>
    <div class="bg"></div>
    <div id="game">
        <div id="start" class="screen active"><h1>${cfg.startTitle}</h1><button class="btn" onclick="startG()">${cfg.startBtn}</button></div>
        <div class="score" id="sc">0</div>
        <div id="stage">
            <div class="pig-container">
                <div class="coins-inside" id="in"></div>
            </div>
        </div>
        <div id="q-txt"></div>
        <div id="btns" class="grid"></div>
    </div>
    <script>
    let s=0, qi=0, stake=0; const cfg=${JSON.stringify(cfg)};
    const dict = {
        ru: { choose: "ВЫБЕРИТЕ СТАВКУ" },
        en: { choose: "CHOOSE YOUR BET" },
        de: { choose: "EINSATZ WÄHLEN" }
    };
    const t = dict[cfg.lang] || dict.ru;

    function startG(){ document.getElementById('start').classList.remove('active'); showStakes(); }
    
    function showStakes(){
        if(qi>=cfg.data.length){ 
            document.getElementById('q-txt').innerText=cfg.endText; 
            document.getElementById('btns').innerHTML=''; 
            return; 
        }
        document.getElementById('q-txt').innerText = t.choose;
        document.getElementById('btns').innerHTML='';
        [10,25,50,100].forEach(v=>{
            let b=document.createElement('button'); b.className='btn'; b.innerText=v;
            b.onclick=()=>{ stake=v; showQ(); }; document.getElementById('btns').appendChild(b);
        });
    }

    function showQ(){
        let q=cfg.data[qi]; document.getElementById('q-txt').innerText=q.q;
        document.getElementById('btns').innerHTML='';
        [...q.a].sort(()=>Math.random()-0.5).forEach(text=>{
            let b=document.createElement('button'); b.className='btn'; b.innerText=text;
            b.onclick=()=>{
                if(text===q.a[0]){ 
                    s+=stake; drop(); 
                } else { 
                    s=Math.max(0, s-stake); 
                    clearOne(); 
                }
                document.getElementById('sc').innerText=s; 
                qi++; 
                setTimeout(showStakes, 1000);
            }; 
            document.getElementById('btns').appendChild(b);
        });
    }

    function drop(){
        let c=document.createElement('div'); c.className='falling-coin'; 
        document.getElementById('stage').appendChild(c);
        setTimeout(()=>{ 
            c.remove(); 
            let m=document.createElement('div'); 
            m.className='coin-mini'; 
            document.getElementById('in').appendChild(m); 
        }, 600);
    }

    function clearOne(){ 
        let inDiv=document.getElementById('in'); 
        if(inDiv.lastChild) inDiv.lastChild.remove(); 
    }
    <\/script></body></html>`;
}
