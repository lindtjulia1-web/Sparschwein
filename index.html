<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Teacher Panel: –ö–æ–ø–∏–ª–∫–∞ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏</title>
    <style>
        :root { --accent: #f9e076; --bg: #0f0f12; --panel: #18181c; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        /* –ë–æ–∫–æ–≤–∞—è –ø–∞–Ω–µ–ª—å —Å –ø—Ä–æ–∫—Ä—É—Ç–∫–æ–π */
        .sidebar { width: 400px; background: var(--panel); border-right: 1px solid #333; display: flex; flex-direction: column; }
        .sidebar-header { padding: 20px; border-bottom: 1px solid #333; }
        .sidebar-content { padding: 20px; overflow-y: auto; flex: 1; }
        
        h2 { color: var(--accent); font-size: 16px; text-transform: uppercase; letter-spacing: 1px; margin: 0; }
        h3 { font-size: 12px; color: var(--accent); text-transform: uppercase; margin: 20px 0 10px 0; border-left: 3px solid var(--accent); padding-left: 10px; opacity: 0.8; }
        
        .field-group { margin-bottom: 15px; }
        label { display: block; font-size: 11px; color: #888; margin-bottom: 5px; font-weight: bold; text-transform: uppercase; }
        input, select, textarea { width: 100%; background: #26262e; border: 1px solid #3e3e42; color: #fff; padding: 10px; border-radius: 8px; box-sizing: border-box; outline: none; transition: 0.3s; font-size: 13px; }
        input:focus, textarea:focus { border-color: var(--accent); }
        textarea { height: 80px; resize: vertical; font-family: monospace; }
        
        .btn-group { padding: 20px; background: #121216; border-top: 1px solid #333; }
        .btn { background: var(--accent); color: #000; border: none; padding: 14px; border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.3s; text-transform: uppercase; font-size: 12px; width: 100%; margin-bottom: 8px; }
        .btn:hover { background: #fff; transform: translateY(-2px); }
        .btn-secondary { background: #333; color: #fff; }

        /* –ó–æ–Ω–∞ –ø—Ä–µ–≤—å—é */
        .preview-zone { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; background: #050505; position: relative; }
        #ifr-container { background: #111; border-radius: 40px; box-shadow: 0 30px 100px rgba(0,0,0,0.8); overflow: hidden; border: 1px solid #222; }
        iframe { width: 100%; height: 100%; border: none; }

        /* –ú–æ–¥–∞–ª–∫–∞ —Å –∫–æ–¥–æ–º */
        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 999; padding: 20px; }
        .modal-content { background: #1a1a1e; padding: 30px; border-radius: 20px; width: 100%; max-width: 800px; border: 1px solid var(--accent); }
        #final-code { width: 100%; height: 300px; background: #000; color: #f9e076; font-family: monospace; padding: 15px; border-radius: 10px; border: 1px solid #333; font-size: 11px; margin-bottom: 15px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-header">
        <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ (Teacher Panel)</h2>
    </div>
    <div class="sidebar-content">
        <h3>üìÅ –ö–æ–Ω—Ç–µ–Ω—Ç</h3>
        <div class="field-group">
            <label>–¢–µ–∫—Å—Ç—ã –∑–∞–¥–∞–Ω–∏–π (JSON —Ñ–æ—Ä–º–∞—Ç)</label>
            <textarea id="c-questions">[{"q":"Ich ... (haben) ein Haus","a":["habe","hast","hat","haben"],"c":0}]</textarea>
        </div>
        <div class="field-group">
            <label>–¢–∏–ø –∑–∞–¥–∞–Ω–∏–π</label>
            <select id="c-type">
                <option value="choice">–í—ã–±–æ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–∞</option>
                <option value="oral">–£—Å—Ç–Ω–æ (—Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∞)</option>
                <option value="error">–ü–æ–∏—Å–∫ –æ—à–∏–±–∫–∏</option>
            </select>
        </div>

        <h3>‚öôÔ∏è –ú–µ—Ö–∞–Ω–∏–∫–∞</h3>
        <div class="field-group">
            <label>–°—Ç–∞–≤–∫–∏ (–º–∏–Ω / –º–∞–∫—Å)</label>
            <div style="display:flex; gap:5px;">
                <input type="number" id="m-min" value="10">
                <input type="number" id="m-max" value="50">
            </div>
        </div>
        <div class="field-group">
            <label>–®—Ç—Ä–∞—Ñ—ã –ø—Ä–∏ –æ—à–∏–±–∫–µ</label>
            <select id="m-penalty">
                <option value="on">–í–∫–ª—é—á–µ–Ω—ã (—É—Ç–µ—á–∫–∞ –ø–µ—Å–∫–∞)</option>
                <option value="off">–û—Ç–∫–ª—é—á–µ–Ω—ã</option>
            </select>
        </div>
        <div class="field-group">
            <label>–†–µ–∂–∏–º –∏–≥—Ä—ã</label>
            <select id="m-mode">
                <option value="risk">–†–µ–∂–∏–º —Ä–∏—Å–∫–∞ (–∞–∑–∞—Ä—Ç)</option>
                <option value="learn">–†–µ–∂–∏–º –æ–±—É—á–µ–Ω–∏—è (—Å–ø–æ–∫–æ–π–Ω—ã–π)</option>
            </select>
        </div>

        <h3>üìà –ü—Ä–æ–≥—Ä–µ—Å—Å</h3>
        <div class="field-group">
            <label>–¶–µ–ª—å (—Ä–∞–∑–º–µ—Ä –∫–æ–ø–∏–ª–∫–∏)</label>
            <input type="number" id="p-max" value="500">
        </div>
        <div class="field-group">
            <label>–†–µ–∂–∏–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞</label>
            <select id="p-team">
                <option value="ind">–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–π</option>
                <option value="team">–ö–æ–º–∞–Ω–¥–Ω—ã–π –±–∞–Ω–∫</option>
            </select>
        </div>

        <h3>üí¨ –§–∏–¥–±–µ–∫</h3>
        <div class="field-group">
            <label>–ó–≤—É–∫–æ–≤—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã</label>
            <select id="f-sound">
                <option value="on">–í–∫–ª—é—á–µ–Ω—ã</option>
                <option value="off">–í—ã–∫–ª—é—á–µ–Ω—ã</option>
            </select>
        </div>
        <div class="field-group">
            <label>–¢–µ–∫—Å—Ç –ø—Ä–∏ –ø–æ–±–µ–¥–µ</label>
            <input type="text" id="f-win" value="–ó–û–õ–û–¢–û–ï –ò–ó–û–ë–ò–õ–ò–ï!">
        </div>

        <h3>üé® –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å</h3>
        <div class="field-group">
            <label>–Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞</label>
            <select id="i-lang">
                <option value="ru">–†—É—Å—Å–∫–∏–π</option>
                <option value="en">English</option>
                <option value="de">Deutsch</option>
            </select>
        </div>
        <div class="field-group">
            <label>–¶–≤–µ—Ç –ø–µ—Å–∫–∞</label>
            <input type="color" id="i-color" value="#f9e076">
        </div>
    </div>

    <div class="btn-group">
        <button class="btn" onclick="updatePreview()">–û–±–Ω–æ–≤–∏—Ç—å –ø—Ä–µ–≤—å—é</button>
        <button class="btn btn-secondary" onclick="showCode()">–ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –¥–ª—è Genially</button>
    </div>
</div>

<div class="preview-zone">
    <div id="ifr-container">
        <iframe id="preview-ifr"></iframe>
    </div>
</div>

<div id="modal">
    <div class="modal-content">
        <h3 style="margin-top:0;">–ö–æ–¥ –≤–∏–¥–∂–µ—Ç–∞ –≥–æ—Ç–æ–≤:</h3>
        <textarea id="final-code" readonly onclick="this.select()"></textarea>
        <button class="btn" onclick="document.getElementById('modal').style.display='none'">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>
</div>

<script>
function generateWidgetHTML() {
    // –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–∑ –ø–∞–Ω–µ–ª–µ–π
    const config = {
        questions: document.getElementById('c-questions').value,
        type: document.getElementById('c-type').value,
        min: document.getElementById('m-min').value,
        max: document.getElementById('m-max').value,
        penalty: document.getElementById('m-penalty').value,
        mode: document.getElementById('m-mode').value,
        pMax: document.getElementById('p-max').value,
        sound: document.getElementById('f-sound').value,
        winText: document.getElementById('f-win').value,
        lang: document.getElementById('i-lang').value,
        sandColor: document.getElementById('i-color').value
    };

    return `<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        :root { --gold: \${config.sandColor}; --glass: rgba(255,255,255,0.2); }
        body { background: #0a0a0a; margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; color: #fff; }
        .game-card { width: 360px; background: #111; border-radius: 40px; padding: 30px; text-align: center; border: 1px solid #222; position: relative; }
        .score { font-size: 50px; color: var(--gold); font-weight: bold; margin: 10px 0; }
        .q-text { min-height: 80px; font-size: 18px; margin: 15px 0; display:flex; align-items:center; justify-content:center; }
        .btn { background: transparent; border: 1px solid var(--gold); color: var(--gold); padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: bold; text-transform: uppercase; margin: 5px; transition: 0.2s; }
        .btn:hover { background: var(--gold); color: #000; }
        .pig-box { position: relative; width: 300px; height: 200px; margin: 0 auto; }
        .pig-svg { width: 100%; height: 100%; overflow: visible; }
        #sand-rect { transition: all 1.5s cubic-bezier(0.4, 0, 0.2, 1); }
        .hidden { display: none; }
        .falling-grain { position: absolute; width: 3px; height: 3px; background: var(--gold); border-radius: 50%; pointer-events: none; }
    </style>
</head>
<body>
<div class="game-card">
    <div class="pig-box" id="pbox">
        <svg class="pig-svg" viewBox="0 0 320 220">
            <defs>
                <mask id="pm"><path d="M60,110 C60,70 110,50 170,50 C250,50 290,80 290,125 C290,165 240,190 170,190 C100,190 60,160 60,110" fill="white"/></mask>
            </defs>
            <g mask="url(#pm)"><rect id="sand-rect" x="50" y="190" width="250" height="0" fill="var(--gold)"/></g>
            <path d="M60,110 C60,70 110,50 170,50 C250,50 290,80 290,125 C290,165 240,190 170,190 C100,190 60,160 60,110" fill="none" stroke="var(--glass)" stroke-width="2"/>
            <path d="M60,100 L45,100 C42,100 40,103 40,110 C40,117 42,120 45,120 L60,120 M110,190 C110,210 90,210 90,190 M250,185 C250,205 230,205 230,185" stroke="var(--glass)" fill="none" />
        </svg>
    </div>
    <div class="score" id="sv">0</div>
    <div id="game-ui">
        <div class="q-text" id="qt">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
        <div id="ans-box"></div>
    </div>
</div>

<script>
    const config = {
        qs: \${config.questions},
        pMax: \${config.pMax},
        penalty: '\${config.penalty}',
        winTxt: '\${config.winText}',
        snd: '\${config.sound}'
    };
    let score = 0, qIdx = 0;

    function init() {
        showQ();
    }

    function showQ() {
        const q = config.qs[qIdx];
        document.getElementById('qt').innerText = q.q;
        const box = document.getElementById('ans-box');
        box.innerHTML = '';
        q.a.forEach((ans, i) => {
            const b = document.createElement('button');
            b.className = 'btn';
            b.innerText = ans;
            b.onclick = () => check(i);
            box.appendChild(b);
        });
    }

    function check(i) {
        const correct = i === config.qs[qIdx].c;
        if(correct) {
            score += 50; 
            dropSand();
        } else if(config.penalty === 'on') {
            score = Math.max(0, score - 20);
        }
        updatePig();
        qIdx = (qIdx + 1) % config.qs.length;
        showQ();
    }

    function updatePig() {
        document.getElementById('sv').innerText = score;
        const h = Math.min(140, (score/config.pMax)*140);
        document.getElementById('sand-rect').setAttribute('y', 190 - h);
        document.getElementById('sand-rect').setAttribute('height', h);
    }

    function dropSand() {
        for(let i=0; i<15; i++) {
            const g = document.createElement('div'); g.className='falling-grain';
            g.style.left = (150 + Math.random()*20)+'px'; g.style.top='50px';
            document.getElementById('pbox').appendChild(g);
            g.animate([{transform:'translateY(0)'},{transform:'translateY(120px)',opacity:0}], 1000).onfinish=()=>g.remove();
        }
    }
    init();
<\/script>
</body>
</html>`;
}

function updatePreview() {
    const ifr = document.getElementById('preview-ifr');
    const container = document.getElementById('ifr-container');
    container.style.width = '400px';
    container.style.height = '550px';
    const blob = new Blob([generateWidgetHTML()], {type: 'text/html'});
    ifr.src = URL.createObjectURL(blob);
}

function showCode() {
    const html = generateWidgetHTML().replace(/"/g, '&quot;').replace(/'/g, '&apos;');
    document.getElementById('final-code').value = `<iframe width="400" height="550" srcdoc="\${html}" frameborder="0" scrolling="no" style="border:none;overflow:hidden;"></iframe>`;
    document.getElementById('modal').style.display = 'flex';
}

window.onload = updatePreview;
</script>
</body>
</html>
