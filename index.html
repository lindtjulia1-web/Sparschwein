<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        :root {
            --gold: #f9e076;
            --gold-gradient: linear-gradient(to top, #bf953f, #fcf6ba, #b38728, #fbf5b7, #aa771c);
            --glass-stroke: rgba(255, 255, 255, 0.2);
            --error-red: #ff5252;
        }
        body { background: #0a0a0a; margin: 0; font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; }

        .game-card {
            width: 380px; background: #111; border-radius: 45px; padding: 35px;
            text-align: center; border: 1px solid #222; box-shadow: 0 40px 120px rgba(0,0,0,0.9);
            position: relative; z-index: 10;
        }

        .lang-switch { position: absolute; top: 25px; right: 35px; display: flex; gap: 8px; z-index: 20; }
        .lang-btn {
            background: #1a1a1a; border: 1px solid #333; color: #555;
            font-size: 10px; padding: 4px 10px; cursor: pointer; border-radius: 6px; transition: 0.3s;
        }
        .lang-btn.active { border-color: var(--gold); color: var(--gold); background: #221e0a; }

        .pig-container { position: relative; width: 300px; height: 220px; margin: 0 auto; }

        /* Маска контура свинки */
        .sand-mask {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            clip-path: path('M160,55 C240,55 280,85 280,120 C280,155 235,185 160,185 C85,185 40,155 40,120 C40,85 80,55 160,55 Z');
            z-index: 1;
        }

        .sand-fill {
            position: absolute; bottom: 35px; left: 0; width: 100%; height: 0%;
            background: var(--gold-gradient); transition: height 1.5s cubic-bezier(0.17, 0.67, 0.83, 0.67);
            background-size: 200% 200%;
            animation: sandShimmer 3s infinite alternate;
        }

        @keyframes sandShimmer {
            from { background-position: 0% 0%; }
            to { background-position: 100% 100%; }
        }

        .pig-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; fill: none; stroke: var(--glass-stroke); stroke-width: 1.5; }

        /* Эффекты крупинок */
        .falling-grain { position: absolute; width: 4px; height: 4px; background: var(--gold); border-radius: 50%; z-index: 2; pointer-events: none; }
        .leak-grain { position: absolute; width: 3px; height: 3px; background: #666; border-radius: 50%; z-index: 10; pointer-events: none; }

        .score { font-size: 58px; color: var(--gold); font-weight: bold; margin: 5px 0; }
        .q-text { min-height: 60px; font-size: 18px; margin: 15px 0; color: #ddd; line-height: 1.4; }
        
        .btn-group { display: flex; flex-direction: column; gap: 10px; align-items: center; }
        .row { display: flex; gap: 10px; justify-content: center; width: 100%; }
        
        .btn {
            background: transparent; border: 1px solid var(--gold); color: var(--gold);
            padding: 10px 20px; border-radius: 12px; cursor: pointer; font-weight: bold; transition: 0.2s;
        }
        .btn:hover { background: var(--gold); color: #000; box-shadow: 0 0 15px rgba(249, 224, 118, 0.3); }
        .btn-ans { border-color: #444; color: #fff; width: 100%; }

        .feedback { font-size: 14px; font-weight: bold; margin-bottom: 10px; min-height: 20px; letter-spacing: 1px; }
        .hidden { display: none; }
        
        .shake { animation: shake 0.4s; }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-6px); }
            40% { transform: translateX(6px); }
            60% { transform: translateX(-3px); }
            80% { transform: translateX(3px); }
        }
    </style>
</head>
<body>

<div class="game-card">
    <div class="lang-switch">
        <button class="lang-btn active" onclick="setLang('ru', this)">RU</button>
        <button class="lang-btn" onclick="setLang('en', this)">EN</button>
        <button class="lang-btn" onclick="setLang('de', this)">DE</button>
    </div>

    <div class="pig-container" id="pig-box">
        <div class="sand-mask">
            <div id="sand" class="sand-fill"></div>
        </div>
        
        <svg class="pig-svg" viewBox="0 0 320 220">
            <path d="M160,55 C240,55 280,85 280,120 C280,155 235,185 160,185 C85,185 40,155 40,120 C40,85 80,55 160,55" />
            <rect x="145" y="52" width="30" height="4" rx="2" fill="rgba(255,255,255,0.4)" />
            <path d="M100,185 L95,205 M220,185 L225,205" stroke-linecap="round" stroke-width="3" />
            <circle cx="285" cy="120" r="8" stroke-width="1" />
        </svg>
    </div>

    <div id="diff-tag" style="font-size: 10px; color: #444; margin-top: 10px; letter-spacing: 2px;">LEVEL: EASY</div>
    <div class="score" id="total-val">0</div>
    <div class="q-text" id="question">Выберите сложность:</div>

    <div id="diff-screen" class="btn-group">
        <div class="row">
            <button class="btn" onclick="initGame('easy')">EASY</button>
            <button class="btn" onclick="initGame('hard')">HARD</button>
        </div>
    </div>

    <div id="bet-screen" class="hidden">
        <div class="row">
            <button class="btn" onclick="askQuestion(10)">10</button>
            <button class="btn" onclick="askQuestion(25)">25</button>
            <button class="btn" onclick="askQuestion(50)">50</button>
        </div>
    </div>

    <div id="ans-screen" class="hidden">
        <div class="btn-group" id="ans-list"></div>
    </div>

    <div id="res-screen" class="hidden">
        <div id="res-msg" class="feedback"></div>
        <button class="btn" id="next-btn" onclick="showBetScreen()"></button>
    </div>
</div>

<script>
    let score = 0;
    let difficulty = 'easy';
    let currentBet = 0;
    let curLang = 'ru';
    let qIdx = 0;
    const MAX_SCORE = 500;

    // --- ЗВУКОВОЙ ДВИЖОК ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playTone(freq, type, duration, vol) {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime);
        gain.gain.setValueAtTime(vol, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
    }

    function soundWin() {
        playTone(880, 'sine', 0.1, 0.2); // Первый дзынь
        setTimeout(() => playTone(1320, 'sine', 0.2, 0.1), 100); // Второй дзынь выше
    }

    function soundLoss() {
        playTone(150, 'sawtooth', 0.3, 0.1); // Низкий звук ошибки
    }

    // --- ЛОГИКА ИГРЫ ---
    const data = {
        ru: { next: "ДАЛЕЕ", win: "ЗОЛОТО ДОБАВЛЕНО!", loss: "УТЕЧКА ПЕСКА...", easy: [{q:"Ich ... (haben) ein Haus.", a:["habe","hast"], c:0}], hard: [{q:"Если бы я был богат...", a:["Wäre ich","Ich bin"], c:0}] },
        en: { next: "NEXT", win: "GOLD ADDED!", loss: "SAND LEAK...", easy: [{q:"I ... (have) a car.", a:["have","has"], c:0}], hard: [{q:"If I were you...", a:["Wäre ich","I am"], c:0}] },
        de: { next: "WEITER", win: "GOLD HINZUGEFÜGT!", loss: "SANDVERLUST...", easy: [{q:"Ich ... (haben) Zeit.", a:["habe","hast"], c:0}], hard: [{q:"Wäre ich reich...", a:["Wäre ich","Ich bin"], c:0}] }
    };

    function initGame(d) {
        if (audioCtx.state === 'suspended') audioCtx.resume();
        difficulty = d;
        document.getElementById('diff-tag').innerText = `LEVEL: ${d.toUpperCase()}`;
        document.getElementById('diff-screen').classList.add('hidden');
        showBetScreen();
    }

    function showBetScreen() {
        document.getElementById('res-screen').classList.add('hidden');
        document.getElementById('bet-screen').classList.remove('hidden');
        document.getElementById('question').innerText = (curLang === 'ru' ? "Выберите ставку:" : "Choose bet:");
    }

    function askQuestion(bet) {
        currentBet = bet;
        document.getElementById('bet-screen').classList.add('hidden');
        const q = data[curLang][difficulty][qIdx];
        document.getElementById('question').innerText = q.q;
        const list = document.getElementById('ans-list');
        list.innerHTML = '';
        q.a.forEach((txt, i) => {
            list.innerHTML += `<button class="btn btn-ans" onclick="checkAnswer(${i})">${txt}</button>`;
        });
        document.getElementById('ans-screen').classList.remove('hidden');
    }

    function checkAnswer(idx) {
        const isCorrect = idx === data[curLang][difficulty][qIdx].c;
        document.getElementById('ans-screen').classList.add('hidden');
        
        if(isCorrect) {
            score += currentBet;
            soundWin();
            dropSandEffect();
            document.getElementById('res-msg').style.color = "var(--gold)";
        } else {
            score = Math.max(0, score - currentBet);
            soundLoss();
            leakSandEffect();
            document.getElementById('res-msg').style.color = "var(--error-red)";
        }

        document.getElementById('total-val').innerText = score;
        document.getElementById('res-msg').innerText = isCorrect ? data[curLang].win : data[curLang].loss;
        document.getElementById('next-btn').innerText = data[curLang].next;
        document.getElementById('res-screen').classList.remove('hidden');
        updateSandLevel();
    }

    function dropSandEffect() {
        const container = document.getElementById('pig-box');
        for(let i=0; i<15; i++) {
            setTimeout(() => {
                const grain = document.createElement('div');
                grain.className = 'falling-grain';
                grain.style.left = (145 + Math.random() * 20) + 'px';
                grain.style.top = '52px';
                container.appendChild(grain);
                grain.animate([
                    { transform: 'translateY(0)', opacity: 1 },
                    { transform: `translate(${Math.random()*30-15}px, 100px)`, opacity: 0 }
                ], { duration: 1000 }).onfinish = () => grain.remove();
            }, i * 40);
        }
    }

    function leakSandEffect() {
        document.getElementById('pig-box').classList.add('shake');
        setTimeout(() => document.getElementById('pig-box').classList.remove('shake'), 400);
        const container = document.getElementById('pig-box');
        for(let i=0; i<10; i++) {
            const grain = document.createElement('div');
            grain.className = 'leak-grain';
            grain.style.left = (80 + Math.random() * 140) + 'px';
            grain.style.top = '185px';
            container.appendChild(grain);
            grain.animate([{ opacity: 1 }, { transform: 'translateY(40px)', opacity: 0 }], 600).onfinish = () => grain.remove();
        }
    }

    function updateSandLevel() {
        const h = Math.min(60, (score / MAX_SCORE) * 60);
        document.getElementById('sand').style.height = h + '%';
    }

    function setLang(l, btn) {
        curLang = l;
        document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
    }
</script>
</body>
</html>
