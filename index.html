<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        :root { --sand: linear-gradient(to top, #d4af37, #f9e076, #c5a028); --bg: #0a0a0a; }
        body { background: #000; color: #fff; font-family: sans-serif; display: flex; margin: 0; height: 100vh; }
        
        /* Панель настроек */
        .settings { width: 340px; background: #151515; padding: 20px; border-right: 1px solid #333; overflow-y: auto; }
        input, textarea { width: 100%; background: #000; border: 1px solid #444; color: #fff; padding: 10px; margin: 5px 0 15px; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; background: #f9e076; border: none; padding: 15px; font-weight: bold; cursor: pointer; border-radius: 5px; }

        /* Превью */
        .preview { flex-grow: 1; display: flex; align-items: center; justify-content: center; background: radial-gradient(circle, #222, #000); }
        
        /* ГЛАВНОЕ РЕШЕНИЕ: Контейнер копилки */
        .pig-container { 
            position: relative; 
            width: 300px; height: 220px; 
            margin-bottom: 20px;
        }

        /* Слой песка, который принимает форму свинки */
        .sand-layer {
            position: absolute;
            bottom: 0; left: 0; width: 100%; height: 0%;
            background: var(--sand);
            /* Магия: используем ту же картинку как маску */
            -webkit-mask-image: var(--pig-url);
            mask-image: var(--pig-url);
            -webkit-mask-size: contain;
            mask-size: contain;
            -webkit-mask-repeat: no-repeat;
            mask-repeat: no-repeat;
            -webkit-mask-position: bottom;
            mask-position: bottom;
            transition: height 1s ease-in-out;
            z-index: 1;
        }

        /* Сама картинка свинки (полупрозрачная поверх) */
        .pig-visual {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            object-fit: contain;
            z-index: 2;
            opacity: 0.9;
        }

        .widget-card { background: #1a1a1a; padding: 40px; border-radius: 20px; text-align: center; width: 400px; box-shadow: 0 20px 50px rgba(0,0,0,0.5); }
        .score { font-size: 48px; color: #f9e076; font-weight: bold; margin-bottom: 10px; }
        .btns { display: flex; gap: 10px; justify-content: center; }
        .btn { border: 1px solid #f9e076; background: none; color: #f9e076; padding: 10px 20px; border-radius: 8px; cursor: pointer; width: auto; }
    </style>
</head>
<body>

<div class="settings">
    <h3>Настройка игры</h3>
    <label>Ссылка на свинку (PNG)</label>
    <input type="text" id="inp-img" value="https://i.ibb.co/pX99S99/glass-pig.png" oninput="applySettings()">
    
    <label>Вопрос | Варианты | Верный(0,1)</label>
    <textarea id="inp-data" oninput="applySettings()">Emil ... um neun Uhr gefühstückt.|ist, hat|1</textarea>
    
    <label>Ставки</label>
    <input type="text" id="inp-bets" value="10, 25, 50" oninput="applySettings()">

    <label>Код для Genially</label>
    <textarea id="res-code" readonly style="height: 80px; font-size: 10px; color: #888;"></textarea>
</div>

<div class="preview">
    <div class="widget-card">
        <div class="pig-container" id="v-pig-cont" style="--pig-url: url('https://i.ibb.co/pX99S99/glass-pig.png')">
            <div id="v-sand" class="sand-layer"></div>
            <img id="v-img" class="pig-visual" src="https://i.ibb.co/pX99S99/glass-pig.png">
        </div>
        <div class="score" id="v-score">0</div>
        <div id="v-q" style="margin-bottom: 20px;">Загрузка...</div>
        <div class="btns" id="v-btns"></div>
    </div>
</div>

<script>
    let score = 0;
    let bet = 0;

    function applySettings() {
        const img = document.getElementById('inp-img').value;
        const [q, opts, cor] = document.getElementById('inp-data').value.split('|');
        const bets = document.getElementById('inp-bets').value.split(',');

        document.getElementById('v-img').src = img;
        document.getElementById('v-pig-cont').style.setProperty('--pig-url', `url('${img}')`);
        document.getElementById('v-q').innerText = q;
        
        const btnBox = document.getElementById('v-btns');
        btnBox.innerHTML = '';
        bets.forEach(val => {
            const b = document.createElement('button');
            b.className = 'btn';
            b.innerText = val.trim();
            b.onclick = () => { bet = parseInt(val); alert('Ставка принята: ' + bet); play(opts.split(','), cor); };
            btnBox.appendChild(b);
        });

        // Формируем код для iFrame
        const widgetHtml = document.querySelector('.preview').innerHTML;
        document.getElementById('res-code').value = `<iframe srcdoc='${widgetHtml.replace(/'/g, "&quot;")}' width="100%" height="500" frameborder="0"></iframe>`;
    }

    function play(opts, cor) {
        // Упрощенная демонстрация для превью
        score += bet; 
        updateUI();
    }

    function updateUI() {
        document.getElementById('v-score').innerText = score;
        // Наполняем песком (от 0 до 100%)
        let percent = Math.min(100, (score / 200) * 100);
        document.getElementById('v-sand').style.height = percent + '%';
    }

    applySettings();
</script>

</body>
</html>
