<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>KGB Pile Editor Pro + Rounding</title>
    <style>
        :root { --accent: #f9e076; --bg: #1e1e24; --panel: #2a2a32; --border: #3d3d45; --green: #4caf50; --red: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 380px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 25px; }
        h2 { color: var(--accent); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin: 25px 0 10px; border-left: 3px solid var(--accent); padding-left: 10px; }
        
        .card { background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 15px; border-radius: 20px; margin-bottom: 15px; position: relative; }
        .del-btn { position: absolute; top: 12px; right: 15px; color: var(--red); cursor: pointer; font-weight: bold; font-size: 11px; }
        
        .sidebar-content label { display: block; font-size: 10px; color: #aaa; text-transform: uppercase; margin-top: 8px; }
        .sidebar-content input, .sidebar-content select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 12px; margin-top: 5px; box-sizing: border-box; outline: none; }
        
        .btn { background: #3d3d45; color: #fff; border: none; padding: 14px; width: 100%; border-radius: 15px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: #ffb347; color: #000; margin-top: 20px; } 
        .btn-code { background: #77dd77; color: #000; margin-top: 8px; } 

        .preview { flex: 1; background: #0c0c0e; display: flex; align-items: center; justify-content: center; }
        #device-wrapper { border: 1px solid #333; background: #000; position: relative; overflow: hidden; transition: 0.3s; background-size: cover; background-position: center; }
        iframe { width: 100%; height: 100%; border: none; background: transparent; }
        
        #code-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 100; flex-direction: column; }
        textarea { width: 80%; height: 50%; background: #111; color: var(--accent); padding: 20px; border: 1px solid var(--accent); border-radius: 20px; font-family: monospace; }
        
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input[type="color"] { padding: 2px; height: 38px; cursor: pointer; border-radius: 10px; }

        @keyframes billboard {
            0% { filter: brightness(1) drop-shadow(0 0 2px var(--shad)); }
            50% { filter: brightness(1.5) drop-shadow(0 0 15px var(--shad)); }
            100% { filter: brightness(1) drop-shadow(0 0 2px var(--shad)); }
        }
        .anim-border { animation: billboard 2s infinite ease-in-out; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>–ó–∞–ø—É—Å–∫ –∏ –¢–µ–∫—Å—Ç—ã</h2>
        <label>–ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ</label>
        <input type="text" id="start-title" value="–ì–æ—Ç–æ–≤—ã –∫ –∏–≥—Ä–µ?">
        <label>–¢–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∑–∞–ø—É—Å–∫–∞</label>
        <input type="text" id="start-btn-text" value="–ù–ê–ß–ê–¢–¨">
        <label>–¶–≤–µ—Ç —Ç–µ–∫—Å—Ç–∞</label>
        <input type="color" id="textColor" value="#ffffff">

        <h2>–≠—Ñ—Ñ–µ–∫—Ç—ã –±–∏–ª–±–æ—Ä–¥–∞</h2>
        <div class="color-grid">
            <div><label>–¶–≤–µ—Ç —Ä–∞–º–∫–∏</label><input type="color" id="borderColor" value="#f9e076" onchange="updatePreview()"></div>
            <div><label>–¢–æ–ª—â–∏–Ω–∞ (px)</label><input type="number" id="borderWidth" value="4" onchange="updatePreview()"></div>
        </div>
        <div class="color-grid">
            <div><label>–ó–∞–∫—Ä—É–≥–ª–µ–Ω–∏–µ (px)</label><input type="range" id="borderRadius" min="0" max="100" value="30" oninput="updatePreview()"></div>
            <div><label>–°–≤–µ—á–µ–Ω–∏–µ</label><input type="number" id="shadowBlur" value="15" onchange="updatePreview()"></div>
        </div>

        <h2>–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ</h2>
        <label>–§–æ–Ω (URL –∫–∞—Ä—Ç–∏–Ω–∫–∏)</label>
        <input type="text" id="bg-url" placeholder="https://..." onchange="updatePreview()">
        
        <label>–®—Ä–∏—Ñ—Ç</label>
        <select id="fontFamily" onchange="updatePreview()">
            <option value="'Montserrat', sans-serif">Montserrat</option>
            <option value="'ABeeZee', sans-serif">ABeeZee</option>
            <option value="'Acme', sans-serif">Acme</option>
        </select>
        
        <label>–†–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ (px)</label>
        <input type="range" id="fontSize" min="12" max="32" value="20" oninput="updatePreview()">

        <h2>–†–∞–∑–º–µ—Ä –≤–∏–¥–∂–µ—Ç–∞</h2>
        <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
            <input type="number" id="width" value="400" onchange="updatePreview()">
            <input type="number" id="height" value="600" onchange="updatePreview()">
        </div>

        <h2>–í–æ–ø—Ä–æ—Å—ã</h2>
        <div id="q-container"></div>
        <button class="btn" onclick="addQ()">+ –î–û–ë–ê–í–ò–¢–¨ –í–û–ü–†–û–°</button>

        <h2>–ö–Ω–æ–ø–∫–∏</h2>
        <div class="color-grid">
            <div><label>–¶–≤–µ—Ç</label><input type="color" id="btnColor" value="#f9e076"></div>
            <div><label>–ü—Ä–æ–∑—Ä–∞—á–Ω–æ—Å—Ç—å</label><input type="range" id="btnAlpha" min="0" max="1" step="0.1" value="0.1"></div>
        </div>
        <label>–Ø–∑—ã–∫</label>
        <select id="lang">
            <option value="ru">–†—É—Å—Å–∫–∏–π</option>
            <option value="en">English</option>
            <option value="de">Deutsch</option>
        </select>
    </div>
    <div style="padding: 20px; border-top: 1px solid var(--border);">
        <button class="btn btn-main" onclick="updatePreview()">–û–ë–ù–û–í–ò–¢–¨ –ü–†–ï–í–¨–Æ</button>
        <button class="btn btn-code" onclick="getGeniallyCode()">–ü–û–õ–£–ß–ò–¢–¨ –ö–û–î</button>
    </div>
</div>

<div class="preview">
    <div id="device-wrapper" class="anim-border"><iframe id="ifr"></iframe></div>
</div>

<div id="code-modal">
    <h3 style="color: #fff">–ö–æ–¥ –¥–ª—è Genially:</h3>
    <textarea id="result-code" readonly onclick="this.select()"></textarea>
    <button class="btn" onclick="document.getElementById('code-modal').style.display='none'" style="width: 200px">–ó–ê–ö–†–´–¢–¨</button>
</div>

<script>
function addQ(qText = "", correct = "", wrongs = ["", ""]) {
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = `
        <span class="del-btn" onclick="this.parentElement.remove()">–£–î–ê–õ–ò–¢–¨</span>
        <label>–í–æ–ø—Ä–æ—Å</label><input type="text" class="inp-q" value="${qText}">
        <label style="color:var(--green)">‚úì –í–µ—Ä–Ω—ã–π</label>
        <input type="text" class="inp-correct" value="${correct}">
        <label style="color:var(--red)">√ó –õ–æ–∂–Ω—ã–µ</label>
        <input type="text" class="inp-wrong" value="${wrongs.join(', ')}">
    `;
    document.getElementById('q-container').appendChild(div);
}

function hexToRgba(hex, alpha) {
    let r = parseInt(hex.slice(1, 3), 16),
        g = parseInt(hex.slice(3, 5), 16),
        b = parseInt(hex.slice(5, 7), 16);
    return `rgba(${r}, ${g}, ${b}, ${alpha})`;
}

function buildInnerGame() {
    const finalQs = [];
    document.querySelectorAll('.sidebar-content .card').forEach(card => {
        const q = card.querySelector('.inp-q').value;
        const correct = card.querySelector('.inp-correct').value.trim();
        const wrongs = card.querySelector('.inp-wrong').value.split(',').map(s => s.trim()).filter(s => s !== "");
        if(q && correct) finalQs.push({ q, a: [correct, ...wrongs] }); 
    });

    const cfg = { 
        bg: document.getElementById('bg-url').value,
        radius: document.getElementById('borderRadius').value,
        startTitle: document.getElementById('start-title').value,
        startBtn: document.getElementById('start-btn-text').value,
        textColor: document.getElementById('textColor').value,
        borderColor: document.getElementById('borderColor').value,
        borderWidth: document.getElementById('borderWidth').value,
        shadowColor: document.getElementById('shadowColor').value,
        shadowBlur: document.getElementById('shadowBlur').value,
        lang: document.getElementById('lang').value,
        font: document.getElementById('fontFamily').value,
        fontSize: document.getElementById('fontSize').value,
        btnColor: document.getElementById('btnColor').value,
        btnRgba: hexToRgba(document.getElementById('btnColor').value, document.getElementById('btnAlpha').value),
        data: finalQs 
    };

    const fontName = cfg.font.split(',')[0].replace(/'/g, '');
    const gFont = `https://fonts.googleapis.com/css2?family=${fontName.replace(/ /g, '+')}&display=swap`;

    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <link href="${gFont}" rel="stylesheet">
    <style>
        @keyframes shine {
            0% { border-color: ${cfg.borderColor}; box-shadow: 0 0 ${cfg.shadowBlur}px ${cfg.shadowColor}; }
            50% { border-color: #fff; box-shadow: 0 0 ${parseInt(cfg.shadowBlur)+10}px #fff; }
            100% { border-color: ${cfg.borderColor}; box-shadow: 0 0 ${cfg.shadowBlur}px ${cfg.shadowColor}; }
        }
        body { margin:0; height:100vh; overflow:hidden; font-family:${cfg.font}; background:transparent; color:${cfg.textColor}; display: flex; align-items: center; justify-content: center; }
        .bg-layer { position:absolute; inset:0; background: url('${cfg.bg}') center/cover no-repeat; opacity:1; z-index:-1; border-radius:${cfg.radius}px; }
        #game-root { 
            width: 100%; height: 100%; position: relative; display: flex; flex-direction: column; padding: 20px; box-sizing: border-box; 
            border: ${cfg.borderWidth}px solid ${cfg.borderColor};
            border-radius: ${cfg.radius}px;
            animation: shine 3s infinite ease-in-out;
            background: rgba(0,0,0,0.4);
        }
        .score { font-size: 44px; color: ${cfg.btnColor}; font-weight: 800; text-align: center; }
        #pile-container { flex: 1; position: relative; overflow: hidden; }
        .coin { position: absolute; font-size: 26px; pointer-events: none; }
        .label-sm { font-size: ${cfg.fontSize}px; text-align: center; margin: 15px 0; text-transform: uppercase; }
        .grid { display: grid; grid-template-columns: 1fr; gap: 10px; }
        .btn-ans, .btn-stake, .btn-start { 
            border: 1.5px solid ${cfg.btnColor}; background: ${cfg.btnRgba}; color: ${cfg.btnColor}; 
            padding: 14px; border-radius: 20px; cursor: pointer; font-family: inherit; font-weight: bold;
        }
        .screen { position: absolute; inset: 0; display: none; flex-direction: column; justify-content: center; align-items: center; background: rgba(0,0,0,0.8); border-radius: ${cfg.radius}px; }
        .active { display: flex; }
    </style></head><body>
    <div class="bg-layer"></div>
    <div id="game-root">
        <div id="start-screen" class="screen active"><h1>${cfg.startTitle}</h1><button class="btn-start" onclick="startGame()">${cfg.startBtn}</button></div>
        <div id="game-content" style="flex:1; display:none; flex-direction:column">
            <div class="score" id="s">0</div>
            <div id="pile-container"></div>
            <div class="label-sm" id="ui-label"></div>
            <div id="ctrl" class="grid"></div>
        </div>
    </div>
    <script>
    const cfg = JSON.parse(decodeURIComponent("${encodeURIComponent(JSON.stringify(cfg))}"));
    let score=0, qi=0, currentStake=0;
    const dict = { ru: { stake: '–°—Ç–∞–≤–∫–∞', finish: '–ö–æ–Ω–µ—Ü!' }, en: { stake: 'Stake', finish: 'Finish!' }, de: { stake: 'Einsatz', finish: 'Ende!' } }[cfg.lang];

    function startGame() {
        document.getElementById('start-screen').classList.remove('active');
        document.getElementById('game-content').style.display = 'flex';
        showStakes();
    }
    function showStakes() {
        if(qi >= cfg.data.length) { document.getElementById('ui-label').innerText = dict.finish; return; }
        document.getElementById('ui-label').innerText = dict.stake;
        const c = document.getElementById('ctrl');
        c.innerHTML = '';
        [10, 25, 50, 100].forEach(val => {
            const b = document.createElement('button');
            b.className = 'btn-stake'; b.innerText = val;
            b.onclick = () => { currentStake = val; showQuestion(); };
            c.appendChild(b);
        });
    }
    function showQuestion() {
        document.getElementById('ui-label').innerText = cfg.data[qi].q;
        const c = document.getElementById('ctrl');
        c.innerHTML = '';
        [...cfg.data[qi].a].sort(() => Math.random() - 0.5).forEach(text => {
            const b = document.createElement('button');
            b.className = 'btn-ans'; b.innerText = text;
            b.onclick = () => {
                if(text === cfg.data[qi].a[0]) { score += currentStake; dropCoins(5); } 
                else { score = Math.max(0, score - currentStake); }
                document.getElementById('s').innerText = score;
                qi++; setTimeout(showStakes, 800);
            };
            c.appendChild(b);
        });
    }
    function dropCoins(count) {
        const container = document.getElementById('pile-container');
        for(let i=0; i<count; i++) {
            const coin = document.createElement('div');
            coin.className = 'coin'; coin.innerText = 'ü™ô';
            coin.style.left = (Math.random() * 90) + '%';
            container.appendChild(coin);
            coin.animate([{ top: '-50px' }, { top: '85%' }], { duration: 800, fill: 'forwards' });
        }
    }
    <\/script></body></html>`;
}

function updatePreview() {
    const dev = document.getElementById('device-wrapper');
    const rad = document.getElementById('borderRadius').value;
    const bg = document.getElementById('bg-url').value;
    
    dev.style.setProperty('--shad', document.getElementById('shadowColor').value);
    dev.style.width = document.getElementById('width').value + "px";
    dev.style.height = document.getElementById('height').value + "px";
    dev.style.borderRadius = rad + "px";
    dev.style.border = `${document.getElementById('borderWidth').value}px solid ${document.getElementById('borderColor').value}`;
    dev.style.backgroundImage = bg ? `url('${bg}')` : 'none';
    
    document.getElementById('ifr').srcdoc = buildInnerGame();
}

function getGeniallyCode() {
    const html = buildInnerGame().replace(/"/g, '&quot;');
    document.getElementById('result-code').value = `<iframe width="100%" height="100%" srcdoc="${html}" frameborder="0" scrolling="no" style="border:none; overflow:hidden;"></iframe>`;
    document.getElementById('code-modal').style.display = 'flex';
}

window.onload = () => { 
    addQ("–°–∫–æ–ª—å–∫–æ –∑–æ–ª–æ—Ç—ã—Ö –≤ —Å—É–Ω–¥—É–∫–µ?", "100", ["50", "200"]); 
    updatePreview(); 
};
</script>
</body>
</html>
