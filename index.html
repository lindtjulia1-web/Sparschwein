function buildInnerGame() {
    const cards = Array.from(document.querySelectorAll('#q-container .card'));
    const finalQs = cards.map(function(c) {
        const qVal = c.querySelector('.inp-q').value.trim();
        const corr = c.querySelector('.inp-correct').value.trim();
        const wrongs = c.querySelector('.inp-wrong').value.split(',').map(function(x) { return x.trim(); }).filter(function(x) { return x; });
        return { q: qVal, a: [corr].concat(wrongs) };
    }).filter(function(x) { return x.q && x.a.length > 1; });

    const cfg = {
        bg: document.getElementById('bg-url').value,
        startTitle: document.getElementById('start-title').value,
        startBtn: document.getElementById('start-btn-text').value,
        endText: document.getElementById('end-text').value,
        textColor: document.getElementById('textColor').value,
        borderColor: document.getElementById('borderColor').value,
        borderWidth: document.getElementById('borderWidth').value,
        shadowColor: document.getElementById('shadowColor').value,
        shadowBlur: document.getElementById('shadowBlur').value,
        pigColor: document.getElementById('pigColor').value,
        pigStroke: document.getElementById('pigStroke').value,
        lang: document.getElementById('lang').value,
        font: document.getElementById('fontFamily').value,
        fontSize: document.getElementById('fontSize').value,
        btnColor: document.getElementById('btnColor').value,
        btnRgba: hexToRgba(document.getElementById('btnColor').value, document.getElementById('btnAlpha').value),
        data: finalQs 
    };

    const fontName = cfg.font.split(',')[0].replace(/'/g, '');
    const gFont = 'https://fonts.googleapis.com/css2?family=' + fontName.replace(/ /g, '+') + '&display=swap';
    
    return `<!DOCTYPE html><html><head><meta charset="UTF-8">
    <link href="${gFont}" rel="stylesheet"><style>
    @keyframes shine {
        0%, 100% { border-color: ${cfg.borderColor}; box-shadow: 0 0 ${cfg.shadowBlur}px ${cfg.shadowColor}; }
        50% { border-color: #fff; box-shadow: 0 0 ${parseInt(cfg.shadowBlur)+10}px #fff; }
    }
    @keyframes coinFall {
        0% { transform: translate(-50%, -200px) rotateX(0deg) rotateZ(0deg); opacity: 0; }
        20% { opacity: 1; }
        100% { transform: translate(-50%, var(--fall-y)) rotateX(720deg) rotateZ(360deg); opacity: 1; }
    }
    body { margin:0; height:100vh; overflow:hidden; font-family:${cfg.font}; background:#000; color:${cfg.textColor}; display:flex; align-items:center; justify-content:center; }
    .bg-layer { position:fixed; inset:0; background:url(${cfg.bg}) center/cover no-repeat; opacity:0.5; z-index:-1; }
    #game-root { width:100%; height:100%; position:relative; display:flex; flex-direction:column; padding:20px; box-sizing:border-box; border:${cfg.borderWidth}px solid ${cfg.borderColor}; animation:shine 3s infinite; }
    .score { font-size:54px; color:${cfg.btnColor}; font-weight:900; text-align:center; margin-bottom:10px; text-shadow: 0 0 15px rgba(0,0,0,0.8); }
    #pile-container { flex:1; position:relative; display:flex; align-items:center; justify-content:center; }
    
    /* Свинка - копия формы со скрина */
    .pig-wrap { position:relative; width:260px; height:220px; z-index:5; }
    .pig-svg { width:100%; height:100%; fill:none; stroke:${cfg.pigColor}; stroke-width:${cfg.pigStroke}; stroke-linecap:round; stroke-linejoin:round; filter: drop-shadow(0 0 5px ${cfg.pigColor}44); }
    
    /* Монеты внутри свинки */
    .coins-inside { position:absolute; bottom:55px; left:50%; transform:translateX(-50%); width:120px; height:70px; display:flex; flex-wrap:wrap-reverse; justify-content:center; align-content:flex-start; overflow:hidden; z-index:2; gap: -5px; }
    .stored-coin { width:22px; height:22px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #ffd95a, #8b6508); border:1px solid #5a4408; margin: -2px; box-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    
    /* Монета в полете - КРУПНАЯ И ДЕТАЛЬНАЯ */
    .falling-coin { position:absolute; left:50%; top:0; width:60px; height:60px; z-index:10; pointer-events:none; }
    .coin-design { width:100%; height:100%; border-radius:50%; background:radial-gradient(circle at 35% 35%, #fff4a3 0%, #ffd95a 30%, #8b6508 100%); border:3px solid #5a4408; box-shadow: 0 5px 15px rgba(0,0,0,0.6); display:flex; align-items:center; justify-content:center; position:relative; }
    .coin-design::after { content:'☠'; color: rgba(90, 68, 8, 0.7); font-size: 30px; }
    
    .label-sm { font-size:${cfg.fontSize}px; text-align:center; margin:15px 0; text-transform:uppercase; font-weight:bold; }
    .grid { display:grid; gap:10px; }
    .btn-ans, .btn-stake, .btn-start { border:2px solid ${cfg.btnColor}; background:${cfg.btnRgba}; color:${cfg.btnColor}; padding:14px; border-radius:18px; cursor:pointer; font-family:inherit; font-weight:bold; font-size:18px; transition:0.2s; }
    .btn-ans:hover { background: ${cfg.btnColor}; color: #000; }
    .screen { position:absolute; inset:0; display:none; flex-direction:column; justify-content:center; align-items:center; z-index:100; background:rgba(0,0,0,0.9); }
    .active { display:flex; }
    </style></head><body>
    <div class="bg-layer"></div>
    <div id="game-root">
        <div id="start-screen" class="screen active"><h1>${cfg.startTitle}</h1><button class="btn-start" style="width:200px" onclick="startGame()">${cfg.startBtn}</button></div>
        <div id="game-content" style="flex:1;display:none;flex-direction:column">
            <div class="score" id="s">0</div>
            <div id="pile-container">
                <div class="pig-wrap">
                    <div class="coins-inside" id="coins-inside"></div>
                    <svg class="pig-svg" viewBox="0 0 240 200">
                        <path d="M40,100 Q40,40 120,40 Q200,40 200,100 Q200,160 120,160 Q40,160 40,100" />
                        <path d="M80,45 L70,20 L100,40 M160,45 L170,20 L140,40" />
                        <ellipse cx="210" cy="100" rx="15" ry="20" />
                        <circle cx="206" cy="95" r="3" fill="${cfg.pigColor}" />
                        <circle cx="214" cy="95" r="3" fill="${cfg.pigColor}" />
                        <circle cx="160" cy="80" r="5" fill="${cfg.pigColor}" />
                        <path d="M80,158 L75,185 L95,185 L100,158 M140,158 L145,185 L165,185 L160,158" />
                        <rect x="105" y="40" width="30" height="6" rx="3" />
                    </svg>
                </div>
            </div>
            <div class="label-sm" id="ui-label"></div>
            <div id="ctrl" class="grid"></div>
        </div>
    </div>
    <script>
    var cfg=${JSON.stringify(cfg)};
    var score=0, qi=0, currentStake=0;
    var dict={ru:{stake:"ВЫБЕРИТЕ СТАВКУ",finish:"КОНЕЦ!"},en:{stake:"CHOOSE BET",finish:"FINISH!"},de:{stake:"EINSATZ WÄHLEN",finish:"ENDE!"}}[cfg.lang];

    function startGame(){
        document.getElementById("start-screen").classList.remove("active");
        document.getElementById("game-content").style.display="flex";
        showStakes();
    }

    function showStakes(){
        if(qi >= cfg.data.length){ showFinish(); return; }
        document.getElementById("ui-label").innerText = dict.stake;
        var c = document.getElementById("ctrl"); c.innerHTML = "";
        [10, 25, 50, 100].forEach(function(val){
            var b = document.createElement("button"); b.className="btn-stake"; b.innerText=val;
            b.onclick=function(){ currentStake=val; showQuestion(); };
            c.appendChild(b);
        });
    }

    function showQuestion(){
        document.getElementById("ui-label").innerText = cfg.data[qi].q;
        var c = document.getElementById("ctrl"); c.innerHTML = "";
        var ans = cfg.data[qi].a.slice();
        ans.sort(function(){ return Math.random()-0.5; });
        ans.forEach(function(text){
            var b = document.createElement("button"); b.className="btn-ans"; b.innerText=text;
            b.onclick=function(){
                if(text === cfg.data[qi].a[0]){
                    score += currentStake;
                    dropCoin();
                } else {
                    score = Math.max(0, score - currentStake);
                    removeCoin();
                }
                document.getElementById("s").innerText = score;
                qi++;
                setTimeout(qi >= cfg.data.length ? showFinish : showStakes, 1200);
            };
            c.appendChild(b);
        });
    }

    function dropCoin(){
        var container = document.getElementById("pile-container");
        var coin = document.createElement("div");
        coin.className = "falling-coin";
        coin.innerHTML = '<div class="coin-design"></div>';
        coin.style.setProperty("--fall-y", (100 + Math.random()*20) + "px");
        container.appendChild(coin);
        coin.style.animation = "coinFall 0.8s cubic-bezier(0.6, 0.04, 0.98, 0.33) forwards";
        setTimeout(function(){
            coin.remove();
            var sc = document.createElement("div");
            sc.className = "stored-coin";
            document.getElementById("coins-inside").appendChild(sc);
        }, 800);
    }

    function removeCoin(){
        var inside = document.getElementById("coins-inside");
        if(inside.lastChild) inside.lastChild.remove();
    }

    function showFinish(){
        document.getElementById("ui-label").innerText = cfg.endText || dict.finish;
        document.getElementById("ctrl").innerHTML = "";
    }
    <\/script></body></html>`;
}
