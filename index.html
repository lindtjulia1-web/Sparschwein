<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Редактор: Копилка уверенности v1.0</title>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #0f0f12; color: #fff; margin: 0; display: flex; height: 100vh; }
        .sidebar { width: 350px; background: #18181c; padding: 20px; border-right: 1px solid #333; overflow-y: auto; box-sizing: border-box; }
        h2 { color: #ffcc00; font-size: 16px; text-transform: uppercase; margin-bottom: 20px; border-bottom: 2px solid #ffcc00; padding-bottom: 10px;}
        label { display: block; font-size: 11px; color: #aaa; margin-top: 15px; font-weight: bold; text-transform: uppercase; }
        input, select { width: 100%; background: #26262e; border: 1px solid #3e3e42; color: #fff; padding: 10px; border-radius: 6px; margin-top: 5px; box-sizing: border-box; outline: none; }
        .btn-main { background: #ffcc00; color: #000; border: none; padding: 12px; width: 100%; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 20px; transition: 0.3s; }
        .btn-main:hover { background: #ffe066; transform: translateY(-2px); }
        .preview { flex: 1; display: flex; align-items: center; justify-content: center; background: #050505; flex-direction: column; }
        #ifr-container { border-radius: 20px; overflow: hidden; box-shadow: 0 20px 50px rgba(0,0,0,0.8); background: #111; }
        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 999; }
        .modal-box { background: #1a1a1e; padding: 30px; border-radius: 15px; width: 600px; text-align: center; border: 1px solid #ffcc00; }
        #output-code { width: 100%; height: 200px; background: #000; color: #ffcc00; font-family: 'Consolas', monospace; font-size: 12px; margin: 15px 0; padding: 10px; resize: none; border: 1px solid #333; }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>Настройка Копилки</h2>
    
    <label>GitHub Репозиторий</label>
    <input type="text" id="gh-url" value="https://lindtjulia1-web.github.io/Sparschwein/">
    
    <label>Язык по умолчанию</label>
    <select id="def-lang">
        <option value="RU">Русский</option>
        <option value="EN">English</option>
        <option value="DE">Deutsch</option>
    </select>

    <label>Размер виджета (Ш x В)</label>
    <div style="display:flex; gap:10px;">
        <input type="number" id="pw" value="500">
        <input type="number" id="ph" value="500">
    </div>

    <label>Начальный уровень песка (0-100%)</label>
    <input type="range" id="sand-level" min="0" max="100" value="20">

    <button class="btn-main" onclick="refresh()">ОБНОВИТЬ ПРЕДПРОСМОТР</button>
    <button class="btn-main" style="background:#333; color:#fff;" onclick="openCode()">ПОЛУЧИТЬ КОД</button>
</div>

<div class="preview">
    <div id="ifr-container"><iframe id="ifr" frameborder="0"></iframe></div>
    <p style="color: #555; margin-top: 15px; font-size: 12px;">Предпросмотр активен</p>
</div>

<div id="modal">
    <div class="modal-box">
        <h3 style="margin:0; color:#ffcc00">Код для вставки в Genially:</h3>
        <textarea id="output-code" readonly onclick="this.select()"></textarea>
        <button class="btn-main" onclick="document.getElementById('modal').style.display='none'">ЗАКРЫТЬ</button>
    </div>
</div>

<script>
function buildWidgetHTML() {
    const gh = document.getElementById('gh-url').value;
    const lang = document.getElementById('def-lang').value;
    const sand = document.getElementById('sand-level').value;

    return `<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <style>
        body { margin: 0; height: 100vh; background: #111; display: flex; flex-direction: column; align-items: center; justify-content: center; font-family: sans-serif; color: white; overflow: hidden; }
        .pig-container { position: relative; width: 300px; height: 250px; }
        .pig-svg { width: 100%; height: 100%; fill: none; stroke: #ffcc00; stroke-width: 2; z-index: 2; position: relative; }
        .sand-container { position: absolute; bottom: 45px; left: 50px; width: 200px; height: 140px; overflow: hidden; clip-path: ellipse(45% 45% at 50% 50%); z-index: 1; }
        .sand { position: absolute; bottom: 0; left: 0; width: 100%; background: linear-gradient(to top, #d4af37, #ffcc00); transition: height 1s ease-in-out; height: ${sand}% ; }
        .controls { margin-top: 20px; display: flex; gap: 10px; }
        .btn-lang { padding: 5px 10px; background: #222; border: 1px solid #ffcc00; color: #ffcc00; cursor: pointer; border-radius: 4px; font-size: 12px; }
        .btn-lang.active { background: #ffcc00; color: #000; }
        #score { font-size: 48px; font-weight: bold; margin: 10px 0; color: #ffcc00; text-shadow: 0 0 10px rgba(255,204,0,0.5); }
    </style>
</head>
<body>
    <div class="controls">
        <button class="btn-lang \${'${lang}'==='RU'?'active':''}" onclick="setL('RU')">RU</button>
        <button class="btn-lang \${'${lang}'==='EN'?'active':''}" onclick="setL('EN')">EN</button>
        <button class="btn-lang \${'${lang}'==='DE'?'active':''}" onclick="setL('DE')">DE</button>
    </div>

    <div class="pig-container">
        <svg class="pig-svg" viewBox="0 0 200 150">
            <path d="M100,20 C50,20 10,50 10,85 C10,120 50,140 100,140 C150,140 190,120 190,85 C190,50 150,20 100,20 M170,70 L185,60 M30,140 L40,155 M160,140 L150,155" />
        </svg>
        <div class="sand-container">
            <div id="sand-fill" class="sand"></div>
        </div>
    </div>

    <div id="score">${sand}0</div>
    <div id="label">УВЕРЕННОСТЬ</div>

    <script>
        const texts = {
            RU: { label: "УВЕРЕННОСТЬ" },
            EN: { label: "CONFIDENCE" },
            DE: { label: "ZUVERSICHT" }
        };
        function setL(l) {
            document.querySelectorAll('.btn-lang').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('label').innerText = texts[l].label;
        }
        // Здесь можно добавить логику подгрузки данных из репозитория ${gh}
    <\/script>
</body>
</html>`;
}

function refresh() {
    const w = document.getElementById('pw').value, h = document.getElementById('ph').value;
    const container = document.getElementById('ifr-container');
    const ifr = document.getElementById('ifr');
    container.style.width = w + "px";
    container.style.height = h + "px";
    ifr.style.width = "100%";
    ifr.style.height = "100%";
    const blob = new Blob([buildWidgetHTML()], {type: 'text/html'});
    ifr.src = URL.createObjectURL(blob);
}

function openCode() {
    const html = buildWidgetHTML().replace(/"/g, '&quot;').replace(/'/g, '&apos;');
    const w = document.getElementById('pw').value;
    const h = document.getElementById('ph').value;
    document.getElementById('output-code').value = `<iframe width="${w}" height="${h}" srcdoc="${html}" frameborder="0" scrolling="no" style="border:none; overflow:hidden;"></iframe>`;
    document.getElementById('modal').style.display = 'flex';
}
window.onload = refresh;
</script>
</body>
</html>
