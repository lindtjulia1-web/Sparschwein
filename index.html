<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>KGB Piggy Bank Pro</title>
    <style>
        :root { --accent: #f9e076; --bg: #1e1e24; --panel: #2a2a32; --border: #3d3d45; --green: #4caf50; --red: #f44336; }
        body { font-family: 'Segoe UI', sans-serif; background: #000; color: #fff; margin: 0; display: flex; height: 100vh; overflow: hidden; }
        
        .sidebar { width: 380px; background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; z-index: 10; }
        .sidebar-content { flex: 1; overflow-y: auto; padding: 25px; }
        h2 { color: var(--accent); font-size: 11px; text-transform: uppercase; letter-spacing: 1.5px; margin: 25px 0 10px; border-left: 3px solid var(--accent); padding-left: 10px; }
        
        .card { background: rgba(0,0,0,0.2); border: 1px solid var(--border); padding: 15px; border-radius: 20px; margin-bottom: 15px; position: relative; }
        .del-btn { position: absolute; top: 12px; right: 15px; color: var(--red); cursor: pointer; font-weight: bold; font-size: 11px; }
        
        .sidebar-content label { display: block; font-size: 10px; color: #aaa; text-transform: uppercase; margin-top: 8px; }
        .sidebar-content input, .sidebar-content select { width: 100%; background: #111; border: 1px solid #444; color: #fff; padding: 10px; border-radius: 12px; margin-top: 5px; box-sizing: border-box; outline: none; }
        
        .btn { background: #3d3d45; color: #fff; border: none; padding: 14px; width: 100%; border-radius: 15px; cursor: pointer; font-weight: bold; margin-top: 10px; transition: 0.3s; }
        .btn-main { background: #ffb347; color: #000; margin-top: 20px; } 
        .btn-code { background: #77dd77; color: #000; margin-top: 8px; } 

        .preview { flex: 1; background: #0c0c0e; display: flex; align-items: center; justify-content: center; }
        #device-wrapper { border: 1px solid #333; background: #000; position: relative; overflow: hidden; border-radius: 30px; transition: 0.3s; background-size: cover; background-position: center; }
        iframe { width: 100%; height: 100%; border: none; background: transparent; }
        
        #code-modal { position: fixed; inset: 0; background: rgba(0,0,0,0.95); display: none; align-items: center; justify-content: center; z-index: 100; flex-direction: column; }
        textarea { width: 80%; height: 50%; background: #111; color: var(--accent); padding: 20px; border: 1px solid var(--accent); border-radius: 20px; font-family: monospace; }
        
        .color-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        input[type="color"] { padding: 2px; height: 38px; cursor: pointer; border-radius: 10px; }

        @keyframes billboard {
            0% { filter: brightness(1) drop-shadow(0 0 2px var(--shad)); }
            50% { filter: brightness(1.5) drop-shadow(0 0 15px var(--shad)); }
            100% { filter: brightness(1) drop-shadow(0 0 2px var(--shad)); }
        }
        .anim-border { animation: billboard 2s infinite ease-in-out; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="sidebar-content">
        <h2>Запуск и Тексты</h2>
        <label>Заголовок при запуске</label>
        <input type="text" id="start-title" value="Готовы к игре?">
        <label>Текст кнопки запуска</label>
        <input type="text" id="start-btn-text" value="НАЧАТЬ">
        <label>Цвет текста</label>
        <input type="color" id="textColor" value="#ffffff">

        <h2>Финальный фидбек</h2>
        <input type="text" id="end-text" placeholder="КОНЕЦ ИГРЫ!">

        <h2>Настройки копилки</h2>
        <div class="color-grid">
            <div><label>Цвет контура</label><input type="color" id="pigColor" value="#ffffff"></div>
            <div><label>Толщина</label><input type="number" id="pigStroke" value="2"></div>
        </div>

        <h2>Эффекты билборда</h2>
        <div class="color-grid">
            <div><label>Цвет рамки</label><input type="color" id="borderColor" value="#f9e076"></div>
            <div><label>Толщина</label><input type="number" id="borderWidth" value="4"></div>
        </div>
        <div class="color-grid">
            <div><label>Свечение</label><input type="number" id="shadowBlur" value="15"></div>
            <div><label>Цвет свечения</label><input type="color" id="shadowColor" value="#f9e076"></div>
        </div>

        <h2>Оформление</h2>
        <label>Фон (URL)</label>
        <input type="text" id="bg-url" placeholder="https://...">
        <label>Размер шрифта</label>
        <input type="range" id="fontSize" min="12" max="32" value="20">

        <h2>Размер виджета</h2>
        <div class="color-grid">
            <input type="number" id="width" value="400">
            <input type="number" id="height" value="600">
        </div>

        <h2>Вопросы</h2>
        <div id="q-container"></div>
        <button class="btn" onclick="addQ()">+ ДОБАВИТЬ ВОПРОС</button>

        <h2>Кнопки</h2>
        <div class="color-grid">
            <input type="color" id="btnColor" value="#f9e076">
            <input type="range" id="btnAlpha" min="0" max="1" step="0.1" value="0.2">
        </div>
        <select id="lang">
            <option value="ru">Русский</option>
            <option value="en">English</option>
            <option value="de">Deutsch</option>
        </select>
    </div>
    <div style="padding: 20px; border-top: 1px solid var(--border);">
        <button class="btn btn-main" onclick="updatePreview()">ОБНОВИТЬ ПРЕВЬЮ</button>
        <button class="btn btn-code" onclick="getGeniallyCode()">ПОЛУЧИТЬ КОД</button>
    </div>
</div>

<div class="preview">
    <div id="device-wrapper" class="anim-border"><iframe id="ifr"></iframe></div>
</div>

<div id="code-modal">
    <textarea id="result-code" readonly onclick="this.select()"></textarea>
    <button class="btn" onclick="document.getElementById('code-modal').style.display='none'" style="width: 200px">ЗАКРЫТЬ</button>
</div>

<script>
function addQ(qText, correct, wrongs) {
    qText = qText || "Сколько золотых в сундуке?";
    correct = correct || "100";
    wrongs = wrongs || ["50", "200"];
    const div = document.createElement('div');
    div.className = 'card';
    div.innerHTML = '<span class="del-btn" onclick="this.parentElement.remove()">УДАЛИТЬ</span>' +
        '<label>Вопрос</label><input type="text" class="inp-q" value="' + qText + '">' +
        '<label style="color:var(--green)">✓ Верный ответ</label><input type="text" class="inp-correct" value="' + correct + '">' +
        '<label style="color:var(--red)">× Ложные</label><input type="text" class="inp-wrong" value="' + wrongs.join(', ') + '">';
    document.getElementById('q-container').appendChild(div);
}

function hexToRgba(hex, alpha) {
    let r = parseInt(hex.slice(1, 3), 16), g = parseInt(hex.slice(3, 5), 16), b = parseInt(hex.slice(5, 7), 16);
    return 'rgba(' + r + ', ' + g + ', ' + b + ', ' + alpha + ')';
}

function buildInnerGame() {
    const cards = Array.from(document.querySelectorAll('#q-container .card'));
    const finalQs = cards.map(c => ({
        q: c.querySelector('.inp-q').value,
        a: [c.querySelector('.inp-correct').value].concat(c.querySelector('.inp-wrong').value.split(',').map(x => x.trim()))
    }));

    const cfg = {
        bg: document.getElementById('bg-url').value,
        startTitle: document.getElementById('start-title').value,
        startBtn: document.getElementById('start-btn-text').value,
        endText: document.getElementById('end-text').value || "КОНЕЦ ИГРЫ!",
        textColor: document.getElementById('textColor').value,
        borderColor: document.getElementById('borderColor').value,
        borderWidth: document.getElementById('borderWidth').value,
        shadowColor: document.getElementById('shadowColor').value,
        shadowBlur: document.getElementById('shadowBlur').value,
        pigColor: document.getElementById('pigColor').value,
        pigStroke: document.getElementById('pigStroke').value,
        lang: document.getElementById('lang').value,
        fontSize: document.getElementById('fontSize').value,
        btnColor: document.getElementById('btnColor').value,
        btnRgba: hexToRgba(document.getElementById('btnColor').value, document.getElementById('btnAlpha').value),
        data: finalQs
    };

    return `<!DOCTYPE html><html><head><meta charset="UTF-8"><style>
    @keyframes coinFall { 0% { transform: translate(-50%, -200px) rotate(0); opacity: 0; } 20% { opacity: 1; } 100% { transform: translate(-50%, 120px) rotate(360deg); opacity: 1; } }
    body { margin:0; height:100vh; overflow:hidden; font-family: sans-serif; background:#000; color:${cfg.textColor}; display:flex; flex-direction:column; }
    .bg { position:fixed; inset:0; background:url(${cfg.bg}) center/cover; opacity:0.4; z-index:-1; }
    #game { flex:1; display:flex; flex-direction:column; padding:20px; border:${cfg.borderWidth}px solid ${cfg.borderColor}; box-shadow: 0 0 ${cfg.shadowBlur}px ${cfg.shadowColor}; }
    .score { font-size:40px; text-align:center; color:${cfg.btnColor}; font-weight:bold; }
    #stage { flex:1; position:relative; display:flex; justify-content:center; align-items:center; }
    .pig-wrap { width:280px; height:240px; position:relative; }
    .pig-svg { width:100%; height:100%; fill:none; stroke:${cfg.pigColor}; stroke-width:${cfg.pigStroke}; z-index:5; position:relative; }
    .coins-inside { position:absolute; top:110px; left:65px; width:150px; height:90px; display:flex; flex-wrap:wrap-reverse; align-content:flex-start; justify-content:center; overflow:hidden; z-index:2; }
    .coin-mini { width:20px; height:20px; background:radial-gradient(circle at 30% 30%, #ffd95a, #8b6508); border-radius:50%; border:1px solid #5a4408; margin:1px; }
    .falling-coin { position:absolute; left:50%; top:0; width:40px; height:40px; background:radial-gradient(circle, #fff4a3, #d4a645); border:2px solid #8b6508; border-radius:50%; z-index:10; animation: coinFall 0.8s ease-in forwards; }
    .grid { display:grid; gap:10px; }
    .btn { background:${cfg.btnRgba}; border:1px solid ${cfg.btnColor}; color:${cfg.btnColor}; padding:12px; border-radius:15px; cursor:pointer; font-weight:bold; font-size:${cfg.fontSize}px; }
    .screen { position:absolute; inset:0; background:rgba(0,0,0,0.9); z-index:100; display:none; flex-direction:column; align-items:center; justify-content:center; }
    .active { display:flex; }
    </style></head><body>
    <div class="bg"></div>
    <div id="game">
        <div id="start" class="screen active"><h1>${cfg.startTitle}</h1><button class="btn" onclick="startG()">${cfg.startBtn}</button></div>
        <div class="score" id="sc">0</div>
        <div id="stage">
            <div class="pig-wrap">
                <div class="coins-inside" id="in"></div>
                <svg class="pig-svg" viewBox="0 0 200 160">
                    <path d="M40,80 Q40,30 90,30 Q110,30 110,20 Q110,10 120,10 Q130,10 130,20 Q130,30 150,30 Q190,30 190,80 Q190,130 140,130 L130,150 L110,150 L115,130 L75,130 L80,150 L60,150 L70,130 Q40,130 40,80" />
                    <rect x="85" y="30" width="30" height="4" rx="2" stroke-width="1" />
                    <circle cx="160" cy="70" r="3" fill="${cfg.pigColor}" />
                </svg>
            </div>
        </div>
        <div id="q-txt" style="text-align:center; margin:10px 0;"></div>
        <div id="btns" class="grid"></div>
    </div>
    <script>
    let s=0, qi=0, stake=0; const cfg=${JSON.stringify(cfg)};
    function startG(){ document.getElementById('start').classList.remove('active'); showStakes(); }
    function showStakes(){
        if(qi>=cfg.data.length){ document.getElementById('q-txt').innerText=cfg.endText; document.getElementById('btns').innerHTML=''; return; }
        document.getElementById('q-txt').innerText='ВЫБЕРИТЕ СТАВКУ';
        document.getElementById('btns').innerHTML='';
        [10,25,50,100].forEach(v=>{
            let b=document.createElement('button'); b.className='btn'; b.innerText=v;
            b.onclick=()=>{ stake=v; showQ(); }; document.getElementById('btns').appendChild(b);
        });
    }
    function showQ(){
        let q=cfg.data[qi]; document.getElementById('q-txt').innerText=q.q;
        document.getElementById('btns').innerHTML='';
        [...q.a].sort(()=>Math.random()-0.5).forEach(t=>{
            let b=document.createElement('button'); b.className='btn'; b.innerText=t;
            b.onclick=()=>{
                if(t===q.a[0]){ s+=stake; drop(); } else { s=Math.max(0, s-stake); clearIn(); }
                document.getElementById('sc').innerText=s; qi++; setTimeout(showStakes, 1000);
            }; document.getElementById('btns').appendChild(b);
        });
    }
    function drop(){
        let c=document.createElement('div'); c.className='falling-coin'; 
        document.getElementById('stage').appendChild(c);
        setTimeout(()=>{ c.remove(); let m=document.createElement('div'); m.className='coin-mini'; document.getElementById('in').appendChild(m); }, 800);
    }
    function clearIn(){ let inDiv=document.getElementById('in'); if(inDiv.lastChild) inDiv.lastChild.remove(); }
    <\/script></body></html>`;
}

function updatePreview() {
    const dev = document.getElementById('device-wrapper');
    dev.style.setProperty('--shad', document.getElementById('shadowColor').value);
    dev.style.width = document.getElementById('width').value + 'px';
    dev.style.height = document.getElementById('height').value + 'px';
    dev.style.border = document.getElementById('borderWidth').value + 'px solid ' + document.getElementById('borderColor').value;
    document.getElementById('ifr').srcdoc = buildInnerGame();
}

function getGeniallyCode() {
    document.getElementById('result-code').value = '<iframe width="100%" height="100%" srcdoc="' + buildInnerGame().replace(/"/g, '&quot;') + '" frameborder="0"></iframe>';
    document.getElementById('code-modal').style.display = 'flex';
}

window.onload = () => { addQ(); updatePreview(); };
</script>
</body>
</html>
